<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- PWA Manifest -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#f97316">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Namak Shamak">
<link rel="apple-touch-icon" href="namak_logo.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Namak Shamak - Discover Your Perfect Recipe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* Dark Mode Styles */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            
        }
        
        body.dark-mode .glass-effect {
            background: rgba(30, 30, 46, 0.9);
            backdrop-filter: blur(10px);
        }
        
        body.dark-mode .cuisine-card {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        body.dark-mode .bg-white {
            background-color: #1e1e2e !important;
            color: #e0e0e0;
        }
        
        body.dark-mode input,
        body.dark-mode .filter-chip {
            background-color: #2a2a3e;
            color: #e0e0e0;
            border-color: #3a3a4e;
        }
        
        body.dark-mode input::placeholder {
            color: #888;
        }
        
        body.dark-mode .text-gray-700,
        body.dark-mode .text-gray-800,
        body.dark-mode .text-gray-600 {
            color: #e0e0e0 !important;
        }
        
        body.dark-mode .border-gray-200,
        body.dark-mode .border-gray-100 {
            border-color: #3a3a4e !important;
        }
        
        body.dark-mode .ingredient-item {
            background: linear-gradient(to right, #2a2a3e, #1e1e2e);
            border-left-color: #fb923c;
        }
        
        body.dark-mode .step-item {
            background: linear-gradient(135deg, #2a2a3e 0%, #1e1e2e 100%);
        }
        
        body.dark-mode .recipe-heading {
            border-bottom-color: #3a3a4e;
        }
        
        body.dark-mode .saved-recipe-card,
        body.dark-mode .shopping-item {
            background-color: #2a2a3e;
            border-color: #3a3a4e;
        }
        
        body.dark-mode .saved-recipes-dropdown,
        body.dark-mode .shopping-list-dropdown {
            background-color: #1e1e2e;
            border-color: #3a3a4e;
        }
        
        /* Dark Mode Toggle Button */
        .dark-mode-toggle {
            position: relative;
            width: 60px;
            height: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        body.dark-mode .dark-mode-toggle {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        }
        
        .dark-mode-toggle-circle {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        body.dark-mode .dark-mode-toggle-circle {
            transform: translateX(30px);
        }
        
        /* Dropdown Styles */
        .saved-recipes-btn,
        .shopping-list-btn {
            position: relative;
        }
        
        .saved-recipes-dropdown,
        .shopping-list-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            width: 350px;
            max-height: 500px;
            overflow-y: auto;
            background: white;
            border: 2px solid #fed7aa;
            border-radius: 1rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
        }

        .shopping-list-dropdown {
            width: 400px;
            max-height: 600px;
        }
        
        .saved-recipes-dropdown.show,
        .shopping-list-dropdown.show {
            display: block;
            animation: dropdownSlide 0.3s ease-out;
        }
        
        @keyframes dropdownSlide {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .saved-recipe-card {
            background: #fff7ed;
            border: 1px solid #fed7aa;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .saved-recipe-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.2);
        }
        
        .badge-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes saveSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .save-success {
            animation: saveSuccess 0.3s ease-out;
        }
        
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        .cuisine-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .cuisine-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .cuisine-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        body.dark-mode .cuisine-card:hover {
            box-shadow: 0 20px 40px rgba(0,0,0,0.6);
        }
        
        .cuisine-card:hover::before {
            opacity: 1;
        }
        
        .filter-chip {
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .filter-chip:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .filter-chip.active {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.4);
        }
        
        .recipe-section {
            margin-bottom: 2rem;
        }
        
        .recipe-heading {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ea580c;
            margin: 1.5rem 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid #fed7aa;
        }
        
        .ingredient-item {
            padding: 0.75rem 1rem;
            margin: 0.5rem 0;
            background: linear-gradient(to right, #fff7ed, #ffffff);
            border-left: 4px solid #fb923c;
            border-radius: 0.5rem;
        }
        
        .step-item {
            padding: 1rem 1.25rem;
            margin: 0.75rem 0;
            background: linear-gradient(135deg, #fffbeb 0%, #ffffff 100%);
            border-radius: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: relative;
            padding-left: 3.5rem;
        }
        
        .step-number {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 2rem;
            height: 2rem;
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .popular-dishes-scroll {
            display: flex;
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: #fb923c #fff7ed;
            padding-bottom: 1rem;
        }
        
        .popular-dishes-scroll::-webkit-scrollbar,
        .saved-recipes-dropdown::-webkit-scrollbar,
        .shopping-list-dropdown::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        .popular-dishes-scroll::-webkit-scrollbar-track,
        .saved-recipes-dropdown::-webkit-scrollbar-track,
        .shopping-list-dropdown::-webkit-scrollbar-track {
            background: #fff7ed;
            border-radius: 10px;
        }
        
        body.dark-mode .popular-dishes-scroll::-webkit-scrollbar-track {
            background: #2a2a3e;
        }
        
        .popular-dishes-scroll::-webkit-scrollbar-thumb,
        .saved-recipes-dropdown::-webkit-scrollbar-thumb,
        .shopping-list-dropdown::-webkit-scrollbar-thumb {
            background: #fb923c;
            border-radius: 10px;
        }

        /* Timer Styles */
        .timer-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 0.5rem;
        }

        .timer-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);
        }

        .timer-widget {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 9999;
            max-width: 350px;
        }

        .timer-widget-minimized {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 50px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .timer-widget-expanded {
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
            padding: 1.5rem;
            max-height: 500px;
            overflow-y: auto;
        }

        body.dark-mode .timer-widget-expanded {
            background: #1e1e2e;
            color: #e0e0e0;
        }

        .timer-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #fed7aa;
        }

        body.dark-mode .timer-header {
            border-bottom-color: #3a3a4e;
        }

        .timer-card {
            background: linear-gradient(135deg, #fff7ed, #ffffff);
            border: 2px solid #fed7aa;
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }

        body.dark-mode .timer-card {
            background: linear-gradient(135deg, #2a2a3e, #1e1e2e);
            border-color: #3a3a4e;
        }

        .timer-card.completed {
            border-color: #22c55e;
            background: linear-gradient(135deg, #dcfce7, #ffffff);
            animation: pulse 1s ease-in-out infinite;
        }

        body.dark-mode .timer-card.completed {
            background: linear-gradient(135deg, #1e3a2e, #1e1e2e);
        }

        .timer-display {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            color: #ea580c;
            font-variant-numeric: tabular-nums;
            margin: 1rem 0;
        }

        .timer-controls {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }

        .timer-control-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 0.875rem;
        }

        .timer-control-btn.pause {
            background: linear-gradient(135deg, #eab308, #ca8a04);
            color: white;
        }

        .timer-control-btn.resume {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }

        .timer-control-btn.stop {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .timer-control-btn:hover {
            transform: scale(1.05);
        }

        .timer-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 3px solid #22c55e;
            border-radius: 1.5rem;
            padding: 2rem 3rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            z-index: 10000;
            text-align: center;
            animation: timerComplete 0.5s ease-out;
        }

        body.dark-mode .timer-notification {
            background: #1e1e2e;
            color: #e0e0e0;
        }

        @keyframes timerComplete {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .timer-badge {
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }

        /* Shopping List Styles */
        .shopping-item {
            display: flex;
            align-items: start;
            gap: 0.75rem;
            background: #fff7ed;
            border: 1px solid #fed7aa;
            border-radius: 0.75rem;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s;
        }

        .shopping-item.checked {
            opacity: 0.6;
        }

        .shopping-item.checked .shopping-item-text {
            text-decoration: line-through;
            color: #9ca3af;
        }

        .shopping-item:hover {
            transform: translateX(-2px);
            box-shadow: 0 2px 8px rgba(249, 115, 22, 0.2);
        }

        .shopping-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #22c55e;
        }

        .shopping-item-text {
            flex: 1;
        }

        .shopping-item-ingredient {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        body.dark-mode .shopping-item-ingredient {
            color: #e0e0e0;
        }

        .shopping-item-recipe {
            font-size: 0.75rem;
            color: #6b7280;
            background: #fef3c7;
            padding: 0.125rem 0.5rem;
            border-radius: 0.5rem;
            display: inline-block;
        }

        body.dark-mode .shopping-item-recipe {
            background: #3a3a4e;
            color: #a0a0b0;
        }

        .shopping-delete-btn {
            color: #ef4444;
            cursor: pointer;
            padding: 0.25rem;
            transition: all 0.2s;
        }

        .shopping-delete-btn:hover {
            color: #dc2626;
            transform: scale(1.1);
        }

        .shopping-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding-top: 1rem;
            border-top: 2px solid #fed7aa;
        }

        body.dark-mode .shopping-actions {
            border-top-color: #3a3a4e;
        }

        .shopping-action-btn {
            flex: 1;
            min-width: 100px;
            padding: 0.5rem 1rem;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
        }

        .shopping-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .shopping-action-btn.clear-completed {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .shopping-action-btn.clear-all {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .shopping-action-btn.print-list {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .shopping-action-btn.copy-list {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        .print-btn-container {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid #f3f4f6;
        }

        /* Print Styles */
        @media print {
            nav, footer, #heroSection, #filterSection, #loadingContainer, 
            #errorContainer, #backToHome, #saveRecipeBtn, #newRecipeBtn,
            .dark-mode-toggle, .saved-recipes-btn, .shopping-list-btn,
            .print-btn-container, .timer-widget, .timer-btn, .shopping-actions,
            #addToListBtn {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
            
            #recipeContainer {
                box-shadow: none !important;
                border: none !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .bg-white {
                background: white !important;
            }
            
            .ingredient-item,
            .step-item {
                page-break-inside: avoid;
                background: white !important;
                border: 1px solid #ccc;
            }
            
            .recipe-heading {
                page-break-after: avoid;
                border-bottom: 2px solid #000;
            }
            
            * {
                background: white !important;
                color: black !important;
                box-shadow: none !important;
            }
            
            .step-number {
                border: 2px solid #000 !important;
                background: white !important;
                color: black !important;
            }
        }
        /* Difficulty Badge Styles */
    .difficulty-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 1rem;
        font-weight: 700;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .difficulty-easy {
        background: linear-gradient(135deg, #22c55e, #16a34a);
        color: white;
    }

    .difficulty-medium {
        background: linear-gradient(135deg, #eab308, #ca8a04);
        color: white;
    }

    .difficulty-hard {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
    }

    body.dark-mode .difficulty-badge {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    /* Recipe Metadata Bar */
    .recipe-metadata {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 1.5rem;
        padding: 1rem;
        background: linear-gradient(135deg, #fff7ed, #ffffff);
        border-radius: 1rem;
        margin-bottom: 1.5rem;
        border: 2px solid #fed7aa;
    }

    body.dark-mode .recipe-metadata {
        background: linear-gradient(135deg, #2a2a3e, #1e1e2e);
        border-color: #3a3a4e;
    }

    .metadata-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
        color: #1f2937;
    }

    body.dark-mode .metadata-item {
        color: #e0e0e0;
    }

    .metadata-icon {
        width: 1.25rem;
        height: 1.25rem;
        color: #f97316;
    }

    .metadata-label {
        font-size: 0.875rem;
        color: #6b7280;
        margin-right: 0.25rem;
    }

    body.dark-mode .metadata-label {
        color: #9ca3af;
    }

    /* Difficulty Filter Chips */
    .difficulty-filter-chip {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
    }

    .difficulty-filter-chip.easy {
        border: 2px solid #22c55e;
    }

    .difficulty-filter-chip.easy.active {
        background: linear-gradient(135deg, #22c55e, #16a34a);
    }

    .difficulty-filter-chip.medium {
        border: 2px solid #eab308;
    }

    .difficulty-filter-chip.medium.active {
        background: linear-gradient(135deg, #eab308, #ca8a04);
    }

    .difficulty-filter-chip.hard {
        border: 2px solid #ef4444;
    }

    .difficulty-filter-chip.hard.active {
        background: linear-gradient(135deg, #ef4444, #dc2626);
    }
    /* Tips and Variations Section */
.recipe-tips {
    background: linear-gradient(135deg, #fef3c7, #fde68a);
    border-left: 4px solid #f59e0b;
    padding: 1rem 1.5rem;
    margin: 1.5rem 0;
    border-radius: 0.75rem;
}

body.dark-mode .recipe-tips {
    background: linear-gradient(135deg, #3a3a2e, #2a2a1e);
    border-left-color: #eab308;
}

.recipe-tips h3,
.recipe-tips .recipe-heading {
    color: #d97706;
    margin-bottom: 0.5rem;
}

body.dark-mode .recipe-tips h3,
body.dark-mode .recipe-tips .recipe-heading {
    color: #fbbf24;
}

.recipe-tips p {
    margin: 0.5rem 0;
    line-height: 1.6;
}

/* Cooking Mode - Full-Screen Step View */
.cooking-mode-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    z-index: 10000;
    display: none;
    overflow: hidden;
}

.cooking-mode-overlay.active {
    display: flex;
    flex-direction: column;
    animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.cooking-mode-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 2rem;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 2px solid #f97316;
}

.cooking-mode-exit {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
    padding: 0.75rem 1.5rem;
    border-radius: 1rem;
    font-weight: 600;
    cursor: pointer;
    border: 2px solid #ef4444;
    transition: all 0.2s;
}

.cooking-mode-exit:hover {
    background: #ef4444;
    color: white;
}

.cooking-mode-progress {
    color: white;
    font-size: 1.25rem;
    font-weight: 600;
}

.cooking-mode-next {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(249, 115, 22, 0.2);
    color: #f97316;
    padding: 0.75rem 1.5rem;
    border-radius: 1rem;
    font-weight: 600;
    cursor: pointer;
    border: 2px solid #f97316;
    transition: all 0.2s;
}

.cooking-mode-next:hover {
    background: #f97316;
    color: white;
}

.cooking-mode-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 2rem;
    overflow-y: auto;
}

.cooking-mode-step-container {
    max-width: 800px;
    width: 100%;
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    border-radius: 2rem;
    padding: 3rem;
    border: 2px solid rgba(249, 115, 22, 0.3);
}

.cooking-mode-step-number {
    font-size: 1rem;
    color: #f97316;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 1rem;
}

.cooking-mode-step-text {
    font-size: 2rem;
    line-height: 1.6;
    color: white;
    font-weight: 500;
    margin-bottom: 2rem;
}

.cooking-mode-progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    overflow: hidden;
    margin: 1.5rem 0;
}

.cooking-mode-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #f97316, #ea580c);
    transition: width 0.3s ease;
    border-radius: 10px;
}

.cooking-mode-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    flex-wrap: wrap;
    justify-content: center;
}

.cooking-mode-action-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 2rem;
    border-radius: 1rem;
    font-weight: 600;
    font-size: 1.125rem;
    cursor: pointer;
    transition: all 0.2s;
    border: 2px solid;
}

.cooking-mode-action-btn.timer {
    background: rgba(234, 179, 8, 0.2);
    border-color: #eab308;
    color: #fbbf24;
}

.cooking-mode-action-btn.timer:hover {
    background: #eab308;
    color: white;
}

.cooking-mode-action-btn.ingredients {
    background: rgba(34, 197, 94, 0.2);
    border-color: #22c55e;
    color: #4ade80;
}

.cooking-mode-action-btn.ingredients:hover {
    background: #22c55e;
    color: white;
}

.cooking-mode-footer {
    display: flex;
    justify-content: space-between;
    padding: 2rem;
    background: rgba(0, 0, 0, 0.3);
    border-top: 2px solid rgba(249, 115, 22, 0.3);
}

.cooking-mode-nav-btn {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 2rem;
    border-radius: 1rem;
    font-weight: 600;
    font-size: 1.125rem;
    cursor: pointer;
    transition: all 0.2s;
    border: 2px solid #f97316;
    background: rgba(249, 115, 22, 0.1);
    color: #f97316;
}

.cooking-mode-nav-btn:hover:not(:disabled) {
    background: #f97316;
    color: white;
    transform: translateX(0) scale(1.05);
}

.cooking-mode-nav-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

.cooking-mode-nav-btn.prev:hover:not(:disabled) {
    transform: translateX(-5px) scale(1.05);
}

.cooking-mode-nav-btn.next:hover:not(:disabled) {
    transform: translateX(5px) scale(1.05);
}

/* Ingredients Popup */
.cooking-mode-ingredients-popup {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    border-radius: 1.5rem;
    padding: 2rem;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    z-index: 10001;
    display: none;
}

body.dark-mode .cooking-mode-ingredients-popup {
    background: #1e1e2e;
    color: #e0e0e0;
}

.cooking-mode-ingredients-popup.show {
    display: block;
    animation: popupSlide 0.3s ease-out;
}

@keyframes popupSlide {
    from {
        opacity: 0;
        transform: translate(-50%, -40%);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%);
    }
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .cooking-mode-step-container {
        padding: 2rem 1.5rem;
    }
    
    .cooking-mode-step-text {
        font-size: 1.5rem;
    }
    
    .cooking-mode-nav-btn {
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
    }
    
    .cooking-mode-action-btn {
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
    }
}

/* Print hide */
@media print {
    .cooking-mode-overlay {
        display: none !important;
    }
}
/* Nutritional Information Styles */
.nutrition-container {
    background: linear-gradient(135deg, #ecfccb, #ffffff);
    border: 2px solid #a3e635;
    border-radius: 1.5rem;
    padding: 1.5rem;
    margin: 1.5rem 0;
}

body.dark-mode .nutrition-container {
    background: linear-gradient(135deg, #2a3a1e, #1e1e2e);
    border-color: #4d7c0f;
}

.nutrition-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.25rem;
    font-weight: 700;
    color: #4d7c0f;
    margin-bottom: 1rem;
}

body.dark-mode .nutrition-header {
    color: #a3e635;
}

.nutrition-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.nutrition-item {
    background: white;
    padding: 1rem;
    border-radius: 1rem;
    border: 2px solid #d9f99d;
    text-align: center;
}

body.dark-mode .nutrition-item {
    background: #2a2a3e;
    border-color: #3a4a2e;
}

.nutrition-value {
    font-size: 1.75rem;
    font-weight: 700;
    color: #4d7c0f;
    display: block;
}

body.dark-mode .nutrition-value {
    color: #a3e635;
}

.nutrition-label {
    font-size: 0.875rem;
    color: #6b7280;
    margin-top: 0.25rem;
}

body.dark-mode .nutrition-label {
    color: #9ca3af;
}

/* Dietary Tags */
.dietary-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.dietary-tag {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.5rem 1rem;
    border-radius: 2rem;
    font-size: 0.875rem;
    font-weight: 600;
    border: 2px solid;
}

.dietary-tag.vegan {
    background: #dcfce7;
    border-color: #22c55e;
    color: #15803d;
}

body.dark-mode .dietary-tag.vegan {
    background: #1e3a2e;
    color: #4ade80;
}

.dietary-tag.vegetarian {
    background: #fef3c7;
    border-color: #eab308;
    color: #a16207;
}

body.dark-mode .dietary-tag.vegetarian {
    background: #3a3a1e;
    color: #fbbf24;
}

.dietary-tag.gluten-free {
    background: #fef3c7;
    border-color: #f59e0b;
    color: #92400e;
}

body.dark-mode .dietary-tag.gluten-free {
    background: #3a2a1e;
    color: #fbbf24;
}

.dietary-tag.keto {
    background: #fee2e2;
    border-color: #ef4444;
    color: #991b1b;
}

body.dark-mode .dietary-tag.keto {
    background: #3a1e1e;
    color: #f87171;
}

.dietary-tag.low-sugar {
    background: #dbeafe;
    border-color: #3b82f6;
    color: #1e40af;
}

body.dark-mode .dietary-tag.low-sugar {
    background: #1e2a3a;
    color: #60a5fa;
}

/* Allergen Warning */
.allergen-warning {
    background: linear-gradient(135deg, #fef3c7, #fde68a);
    border: 2px solid #f59e0b;
    border-radius: 1rem;
    padding: 1rem;
    display: flex;
    align-items: start;
    gap: 0.75rem;
}

body.dark-mode .allergen-warning {
    background: linear-gradient(135deg, #3a2a1e, #2a2a1e);
    border-color: #d97706;
}

.allergen-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.allergen-content {
    flex: 1;
}

.allergen-title {
    font-weight: 700;
    color: #92400e;
    margin-bottom: 0.25rem;
}

body.dark-mode .allergen-title {
    color: #fbbf24;
}

.allergen-list {
    color: #78350f;
    font-size: 0.875rem;
}

body.dark-mode .allergen-list {
    color: #d97706;
}

/* Health Score */
.health-score {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: white;
    border-radius: 1rem;
    border: 2px solid #d9f99d;
}

body.dark-mode .health-score {
    background: #2a2a3e;
    border-color: #3a4a2e;
}

.health-score-label {
    font-weight: 600;
    color: #4d7c0f;
}

body.dark-mode .health-score-label {
    color: #a3e635;
}

.health-score-stars {
    font-size: 1.25rem;
}

.health-score-value {
    font-weight: 700;
    color: #6b7280;
}
/* Recipe Variations & Substitutions */
.variations-container {
    background: linear-gradient(135deg, #ede9fe, #ffffff);
    border: 2px solid #a78bfa;
    border-radius: 1.5rem;
    padding: 1.5rem;
    margin: 1.5rem 0;
}

body.dark-mode .variations-container {
    background: linear-gradient(135deg, #2a2a3e, #1e1e2e);
    border-color: #6d28d9;
}

.variations-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.25rem;
    font-weight: 700;
    color: #7c3aed;
    margin-bottom: 1rem;
}

body.dark-mode .variations-header {
    color: #a78bfa;
}

.variation-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
}

.variation-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border-radius: 1rem;
    font-weight: 600;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.2s;
    border: 2px solid;
}

.variation-btn.vegan {
    background: linear-gradient(135deg, #dcfce7, #bbf7d0);
    border-color: #22c55e;
    color: #15803d;
}

.variation-btn.vegan:hover {
    background: #22c55e;
    color: white;
    transform: translateY(-2px);
}

.variation-btn.spicy {
    background: linear-gradient(135deg, #fee2e2, #fecaca);
    border-color: #ef4444;
    color: #991b1b;
}

.variation-btn.spicy:hover {
    background: #ef4444;
    color: white;
    transform: translateY(-2px);
}

.variation-btn.healthy {
    background: linear-gradient(135deg, #dbeafe, #bfdbfe);
    border-color: #3b82f6;
    color: #1e40af;
}

.variation-btn.healthy:hover {
    background: #3b82f6;
    color: white;
    transform: translateY(-2px);
}

.variation-btn.budget {
    background: linear-gradient(135deg, #fef3c7, #fde68a);
    border-color: #f59e0b;
    color: #92400e;
}

.variation-btn.budget:hover {
    background: #f59e0b;
    color: white;
    transform: translateY(-2px);
}

body.dark-mode .variation-btn.vegan {
    background: linear-gradient(135deg, #1e3a2e, #2a3a1e);
    color: #4ade80;
}

body.dark-mode .variation-btn.spicy {
    background: linear-gradient(135deg, #3a1e1e, #2a1e1e);
    color: #f87171;
}

body.dark-mode .variation-btn.healthy {
    background: linear-gradient(135deg, #1e2a3a, #2a3a4e);
    color: #60a5fa;
}

body.dark-mode .variation-btn.budget {
    background: linear-gradient(135deg, #3a2a1e, #2a2a1e);
    color: #fbbf24;
}

/* Substitution Cards */
.substitutions-section {
    margin-top: 1.5rem;
}

.substitution-card {
    background: white;
    border: 2px solid #e9d5ff;
    border-radius: 1rem;
    padding: 1rem;
    margin-bottom: 0.75rem;
    display: flex;
    align-items: start;
    gap: 1rem;
}

body.dark-mode .substitution-card {
    background: #2a2a3e;
    border-color: #4c1d95;
}

.substitution-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.substitution-content {
    flex: 1;
}

.substitution-original {
    font-weight: 700;
    color: #7c3aed;
    margin-bottom: 0.25rem;
}

body.dark-mode .substitution-original {
    color: #a78bfa;
}

.substitution-alternatives {
    color: #6b7280;
    font-size: 0.875rem;
}

body.dark-mode .substitution-alternatives {
    color: #9ca3af;
}

.substitution-arrow {
    color: #a78bfa;
    font-weight: bold;
}

/* Related Recipes */
.related-recipes {
    background: linear-gradient(135deg, #fff7ed, #ffffff);
    border: 2px solid #fed7aa;
    border-radius: 1.5rem;
    padding: 1.5rem;
    margin: 1.5rem 0;
}

body.dark-mode .related-recipes {
    background: linear-gradient(135deg, #2a2a1e, #1e1e2e);
    border-color: #92400e;
}

.related-recipes-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.25rem;
    font-weight: 700;
    color: #ea580c;
    margin-bottom: 1rem;
}

body.dark-mode .related-recipes-header {
    color: #fb923c;
}

.related-recipe-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 0.75rem;
}

.related-recipe-card {
    background: white;
    border: 2px solid #fed7aa;
    border-radius: 1rem;
    padding: 1rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
}

.related-recipe-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(249, 115, 22, 0.2);
    border-color: #fb923c;
}

body.dark-mode .related-recipe-card {
    background: #2a2a3e;
    border-color: #92400e;
}

.related-recipe-emoji {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.related-recipe-name {
    font-weight: 600;
    color: #1f2937;
    font-size: 0.875rem;
}

body.dark-mode .related-recipe-name {
    color: #e0e0e0;
}
/* Search History Styles */
.search-history-btn {
    position: relative;
}

.search-history-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 0.5rem;
    width: 350px;
    max-height: 500px;
    overflow-y: auto;
    background: white;
    border: 2px solid #ddd6fe;
    border-radius: 1rem;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    display: none;
}

body.dark-mode .search-history-dropdown {
    background: #1e1e2e;
    border-color: #4c1d95;
}

.search-history-dropdown.show {
    display: block;
    animation: dropdownSlide 0.3s ease-out;
}

.history-header {
    padding: 1rem 1.5rem;
    border-bottom: 2px solid #e9d5ff;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

body.dark-mode .history-header {
    border-bottom-color: #4c1d95;
}

.history-header h3 {
    font-size: 1.125rem;
    font-weight: 700;
    color: #7c3aed;
}

body.dark-mode .history-header h3 {
    color: #a78bfa;
}

.history-clear-btn {
    color: #ef4444;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    padding: 0.25rem 0.75rem;
    border-radius: 0.5rem;
    transition: all 0.2s;
}

.history-clear-btn:hover {
    background: #fee2e2;
}

body.dark-mode .history-clear-btn:hover {
    background: #3a1e1e;
}

.history-group {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #f3e8ff;
}

body.dark-mode .history-group {
    border-bottom-color: #3a2a4e;
}

.history-group-title {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    color: #9ca3af;
    margin-bottom: 0.75rem;
    letter-spacing: 0.05em;
}

.history-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    background: #faf5ff;
    border-radius: 0.75rem;
    cursor: pointer;
    transition: all 0.2s;
}

.history-item:hover {
    background: #f3e8ff;
    transform: translateX(-2px);
}

body.dark-mode .history-item {
    background: #2a2a3e;
}

body.dark-mode .history-item:hover {
    background: #3a3a4e;
}

.history-emoji {
    font-size: 1.5rem;
}

.history-content {
    flex: 1;
    min-width: 0;
}

.history-dish-name {
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 0.125rem;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

body.dark-mode .history-dish-name {
    color: #e0e0e0;
}

.history-time {
    font-size: 0.75rem;
    color: #6b7280;
}

body.dark-mode .history-time {
    color: #9ca3af;
}

.history-delete-btn {
    color: #9ca3af;
    padding: 0.25rem;
    border-radius: 0.5rem;
    transition: all 0.2s;
    cursor: pointer;
}

.history-delete-btn:hover {
    color: #ef4444;
    background: #fee2e2;
}

body.dark-mode .history-delete-btn:hover {
    background: #3a1e1e;
}

.history-empty {
    padding: 3rem 1.5rem;
    text-align: center;
    color: #9ca3af;
}

.history-empty-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}
/* Voice Assistant Styles */
.voice-button {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background: linear-gradient(135deg, #8b5cf6, #ec4899);
    color: white;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 8px 30px rgba(139, 92, 246, 0.4);
    transition: all 0.3s ease;
    z-index: 9999;
}

.voice-button:hover {
    transform: scale(1.1);
    box-shadow: 0 12px 40px rgba(139, 92, 246, 0.6);
}

.voice-button.listening {
    animation: pulse 1.5s infinite;
    background: linear-gradient(135deg, #ef4444, #dc2626);
}

@keyframes pulse {
    0%, 100% { transform: scale(1); box-shadow: 0 8px 30px rgba(239, 68, 68, 0.4); }
    50% { transform: scale(1.1); box-shadow: 0 12px 50px rgba(239, 68, 68, 0.8); }
}

.voice-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10000;
}

.voice-overlay.active {
    display: flex;
    animation: fadeIn 0.3s ease-out;
}

.voice-container {
    background: linear-gradient(135deg, #1e1e2e, #2a2a4e);
    border-radius: 2rem;
    padding: 3rem;
    text-align: center;
    max-width: 500px;
    width: 90%;
}

.voice-status {
    font-size: 2rem;
    font-weight: 700;
    color: white;
    margin-bottom: 1rem;
}

.voice-transcript {
    font-size: 1.25rem;
    color: #a78bfa;
    margin-bottom: 2rem;
    min-height: 60px;
    padding: 1rem;
    background: rgba(139, 92, 246, 0.1);
    border-radius: 1rem;
}

.voice-animation {
    width: 150px;
    height: 150px;
    margin: 2rem auto;
    position: relative;
}

.voice-wave {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 3px solid #8b5cf6;
    animation: waveExpand 2s infinite;
}

.voice-wave:nth-child(2) {
    animation-delay: 0.5s;
}

.voice-wave:nth-child(3) {
    animation-delay: 1s;
}

@keyframes waveExpand {
    0% {
        transform: scale(0.5);
        opacity: 1;
    }
    100% {
        transform: scale(1.5);
        opacity: 0;
    }
}

.voice-commands {
    margin-top: 2rem;
    text-align: left;
    color: #9ca3af;
    font-size: 0.875rem;
}

.voice-command-item {
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(139, 92, 246, 0.2);
}
/* Ingredients-Based Recipe Generator */
.ingredients-generator {
    background: linear-gradient(135deg, #fef3c7, #fde68a);
    border: 2px solid #f59e0b;
    border-radius: 1.5rem;
    padding: 2rem;
    margin: 2rem 0;
}

body.dark-mode .ingredients-generator {
    background: linear-gradient(135deg, #3a2a1e, #2a2a1e);
    border-color: #d97706;
}

.ingredients-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.5rem;
    font-weight: 700;
    color: #d97706;
    margin-bottom: 1rem;
}

body.dark-mode .ingredients-header {
    color: #fbbf24;
}

.ingredients-input-container {
    position: relative;
    margin-bottom: 1.5rem;
}

.ingredients-input {
    width: 100%;
    padding: 1rem 1.5rem;
    border: 2px solid #fbbf24;
    border-radius: 1rem;
    font-size: 1rem;
    background: white;
    color: #1f2937;
    transition: all 0.2s;
}

.ingredients-input:focus {
    outline: none;
    border-color: #f59e0b;
    box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.1);
}

body.dark-mode .ingredients-input {
    background: #2a2a3e;
    color: #e0e0e0;
    border-color: #d97706;
}

.ingredient-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.ingredient-tag {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: white;
    border: 2px solid #fbbf24;
    border-radius: 2rem;
    font-weight: 600;
    color: #92400e;
    font-size: 0.875rem;
}

body.dark-mode .ingredient-tag {
    background: #2a2a3e;
    border-color: #d97706;
    color: #fbbf24;
}

.ingredient-tag-remove {
    cursor: pointer;
    color: #ef4444;
    font-weight: bold;
    transition: transform 0.2s;
}

.ingredient-tag-remove:hover {
    transform: scale(1.2);
}

.generate-recipe-btn {
    width: 100%;
    padding: 1rem 2rem;
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: white;
    border: none;
    border-radius: 1rem;
    font-weight: 700;
    font-size: 1.125rem;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
}

.generate-recipe-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
}

.generate-recipe-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.quick-ingredients {
    margin-top: 1rem;
}

.quick-ingredients-label {
    font-size: 0.875rem;
    font-weight: 600;
    color: #92400e;
    margin-bottom: 0.5rem;
}

body.dark-mode .quick-ingredients-label {
    color: #fbbf24;
}

.quick-ingredient-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.quick-ingredient-chip {
    padding: 0.5rem 1rem;
    background: white;
    border: 2px solid #fed7aa;
    border-radius: 1rem;
    font-size: 0.875rem;
    font-weight: 600;
    color: #92400e;
    cursor: pointer;
    transition: all 0.2s;
}

.quick-ingredient-chip:hover {
    background: #fef3c7;
    border-color: #fbbf24;
    transform: translateY(-2px);
}

body.dark-mode .quick-ingredient-chip {
    background: #2a2a3e;
    border-color: #92400e;
    color: #fbbf24;
}

body.dark-mode .quick-ingredient-chip:hover {
    background: #3a2a1e;
    border-color: #d97706;
}
/* Social Share */
.share-btn {
    position: relative;
}

.share-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 0.5rem;
    background: white;
    border: 2px solid #ddd6fe;
    border-radius: 1rem;
    padding: 0.5rem;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    display: none;
    min-width: 220px;
    z-index: 1000;
}

body.dark-mode .share-dropdown {
    background: #1e1e2e;
    border-color: #4c1d95;
}

.share-dropdown.show {
    display: block;
}

.share-option {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    border-radius: 0.75rem;
    cursor: pointer;
    transition: all 0.2s;
    color: #1f2937;
    font-weight: 600;
}

body.dark-mode .share-option {
    color: #e0e0e0;
}

.share-option:hover {
    background: #ede9fe;
    transform: translateX(4px);
}

body.dark-mode .share-option:hover {
    background: #2a2a3e;
}
/* Better Loading Animation */
.loading-container {
    text-align: center;
    padding: 4rem 2rem;
}

.loading-chef {
    max-width: 400px;
    margin: 0 auto;
}

.chef-hat {
    font-size: 5rem;
    animation: bounce 1s infinite;
    margin-bottom: 1.5rem;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-20px); }
}

.loading-text {
    margin-bottom: 2rem;
}

body.dark-mode .loading-text p {
    color: #9ca3af;
}

.loading-bar-container {
    width: 100%;
    height: 8px;
    background: #e5e7eb;
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 2rem;
}

body.dark-mode .loading-bar-container {
    background: #374151;
}

.loading-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #f97316, #ea580c);
    width: 0%;
    animation: loadingProgress 2s ease-in-out infinite;
    border-radius: 10px;
}

@keyframes loadingProgress {
    0% { width: 0%; }
    50% { width: 70%; }
    100% { width: 100%; }
}

.cooking-icons {
    display: flex;
    justify-content: center;
    gap: 1.5rem;
}

.cooking-icon {
    font-size: 2rem;
    animation: float 2s ease-in-out infinite;
}

.cooking-icon:nth-child(1) { animation-delay: 0s; }
.cooking-icon:nth-child(2) { animation-delay: 0.2s; }
.cooking-icon:nth-child(3) { animation-delay: 0.4s; }
.cooking-icon:nth-child(4) { animation-delay: 0.6s; }

@keyframes float {
    0%, 100% { transform: translateY(0px); opacity: 0.7; }
    50% { transform: translateY(-15px); opacity: 1; }
}
/* Mobile Optimization */
@media (max-width: 768px) {
    /* Header */
    header {
        padding: 0.75rem 1rem;
    }
    
    header h1 {
        font-size: 1.25rem;
    }
    
    header .flex.items-center.gap-3 {
        gap: 0.5rem;
    }
    
    header button {
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
    }
    
    header button svg {
        width: 1rem;
        height: 1rem;
    }
    
    /* Hide text on mobile, keep icons */
    header button span:not(.badge-count) {
        display: none !important;
    }
    
    /* Hero section */
    .hero-title {
        font-size: 2rem !important;
    }
    
    .hero-subtitle {
        font-size: 1rem !important;
    }
    
    /* Cuisine cards */
    .cuisine-grid {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 1rem !important;
    }
    
    .cuisine-card {
        padding: 1.5rem 1rem !important;
    }
    
    .cuisine-card .text-6xl {
        font-size: 2.5rem !important;
    }
    
    .cuisine-card h4 {
        font-size: 1.25rem !important;
    }
    
    /* Recipe display */
    .recipe-container {
        padding: 1rem !important;
    }
    
    #recipeDishName {
        font-size: 1.75rem !important;
    }
    
    /* Buttons */
    .recipe-actions {
        flex-direction: column;
        gap: 0.75rem;
    }
    
    .recipe-actions button {
        width: 100%;
        justify-content: center;
    }
    
    /* Metadata */
    .recipe-metadata {
        flex-direction: column;
        gap: 0.75rem;
    }
    
    .metadata-item {
        justify-content: center;
    }
    
    /* Voice button */
    .voice-button {
        width: 60px;
        height: 60px;
        bottom: 1rem;
        right: 1rem;
    }
    
    /* Share dropdown */
    .share-dropdown {
        right: auto;
        left: 0;
    }
}

/* Extra small screens */
@media (max-width: 480px) {
    .cuisine-grid {
        grid-template-columns: 1fr !important;
    }
    
    .filter-chips {
        flex-wrap: wrap;
        justify-content: center;
    }
}
/* Recipe Recommendations */
.recommendations-section {
    background: linear-gradient(135deg, #fef3c7, #fde68a);
    border: 2px solid #fbbf24;
    border-radius: 1.5rem;
    padding: 2rem;
    margin: 2rem 0;
}

body.dark-mode .recommendations-section {
    background: linear-gradient(135deg, #3a2a1e, #2a2a1e);
    border-color: #d97706;
}

.recommendations-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.5rem;
    font-weight: 700;
    color: #d97706;
    margin-bottom: 1rem;
}

body.dark-mode .recommendations-header {
    color: #fbbf24;
}

.recommendation-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
}

.recommendation-card {
    background: white;
    border: 2px solid #fed7aa;
    border-radius: 1rem;
    padding: 1.5rem;
    cursor: pointer;
    transition: all 0.2s;
}

body.dark-mode .recommendation-card {
    background: #2a2a3e;
    border-color: #92400e;
}

.recommendation-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(251, 191, 36, 0.3);
    border-color: #fbbf24;
}

.recommendation-icon {
    font-size: 2.5rem;
    margin-bottom: 0.75rem;
}

.recommendation-name {
    font-size: 1.125rem;
    font-weight: 700;
    color: #92400e;
    margin-bottom: 0.5rem;
}

body.dark-mode .recommendation-name {
    color: #fbbf24;
}

.recommendation-reason {
    font-size: 0.875rem;
    color: #78350f;
}

body.dark-mode .recommendation-reason {
    color: #d97706;
}
/* Easter Eggs */
.confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    background: #f97316;
    position: fixed;
    top: -10px;
    z-index: 9999;
    animation: confettiFall 3s linear forwards;
    pointer-events: none;
}

@keyframes confettiFall {
    to {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
    }
}

.shake {
    animation: shake 0.5s;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    75% { transform: translateX(10px); }
}

.rainbow-text {
    background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: rainbow 3s linear infinite;
}

@keyframes rainbow {
    0% { background-position: 0% 50%; }
    100% { background-position: 200% 50%; }
}

.floating-emoji {
    position: fixed;
    font-size: 3rem;
    animation: floatUp 4s ease-out forwards;
    pointer-events: none;
    z-index: 9999;
}

@keyframes floatUp {
    to {
        transform: translateY(-100vh) rotate(360deg);
        opacity: 0;
    }
}
/* Make dish card text bold and black in dark mode */
body.dark-mode .dish-card h5,
body.dark-mode .dish-card h4,
body.dark-mode .dish-card p {
    color: #000000 !important;
    font-weight: 700 !important;
}

/* Keep emoji visible */
body.dark-mode .dish-emoji,
body.dark-mode .text-4xl {
    filter: none;
}
body.dark-mode .hinglish-bar {
    background: #2a2a3e;
    border: 1px solid #3a3a4e;
}
/* ========================================
   MOBILE OPTIMIZATION FIX
   ======================================== */

@media (max-width: 768px) {
    /* Header improvements */
    header {
        padding: 0.75rem 0.5rem !important;
        flex-wrap: wrap;
    }
    
    header h1 {
        font-size: 1.25rem !important;
        margin-right: auto;
    }
    
    /* Header buttons - stack on mobile */
    header .flex.items-center.gap-3 {
        gap: 0.25rem !important;
        flex-wrap: wrap;
    }
    
    header button {
        padding: 0.5rem 0.75rem !important;
        font-size: 0.75rem !important;
        min-width: auto !important;
    }
    
    /* Hide button text, keep icons only */
    header button span:not(.badge-count):not([class*="emoji"]) {
        display: none !important;
    }
    
    header button svg {
        width: 1.25rem !important;
        height: 1.25rem !important;
        margin: 0 !important;
    }
    
    /* Hero section */
    .hero-title {
        font-size: 1.75rem !important;
        line-height: 1.2 !important;
        margin-bottom: 0.75rem !important;
    }
    
    .hero-subtitle {
        font-size: 0.875rem !important;
        margin-bottom: 1rem !important;
    }
    
    /* Search bar */
#quickSearch {
    font-size: 0.875rem !important;
    padding: 0.75rem !important;
}

#quickSearchBtn {
    padding: 0.875rem 1.25rem !important;
    font-size: 0.875rem !important;
}
    
    /* Ingredients box (yellow section) */
    .ingredients-header {
        font-size: 1.125rem !important;
        padding: 1rem !important;
    }
    
    .ingredients-description {
        font-size: 0.75rem !important;
        padding: 0 1rem !important;
    }
    
    #ingredientsInput {
        font-size: 0.875rem !important;
        padding: 0.75rem !important;
        margin: 0.75rem 1rem !important;
    }
    
    #generateFromIngredientsBtn {
        margin: 0.75rem 1rem 1rem 1rem !important;
        padding: 0.875rem 1.25rem !important;
        font-size: 0.875rem !important;
        width: calc(100% - 2rem) !important;
    }
    
    /* Quick add ingredients */
    .quick-add-ingredients {
        padding: 0 1rem 1rem 1rem !important;
        gap: 0.5rem !important;
    }
    
    .quick-ingredient-btn {
        font-size: 0.75rem !important;
        padding: 0.5rem 0.75rem !important;
    }
    
    /* Cuisine cards */
    .cuisine-grid {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 0.75rem !important;
        padding: 0.75rem !important;
    }
    
    .cuisine-card {
        padding: 1.25rem 0.75rem !important;
    }
    
    .cuisine-card .text-6xl {
        font-size: 2rem !important;
    }
    
    .cuisine-card h4 {
        font-size: 1rem !important;
    }
    
    /* Recipe display */
    .recipe-container {
        padding: 1rem !important;
        margin: 1rem 0.5rem !important;
    }
    
    #recipeDishName {
        font-size: 1.5rem !important;
        line-height: 1.3 !important;
    }
    
    /* Recipe action buttons */
    .recipe-actions {
        flex-direction: column !important;
        gap: 0.75rem !important;
        padding: 0.75rem !important;
    }
    
    .recipe-actions button {
        width: 100% !important;
        justify-content: center !important;
        padding: 0.875rem 1rem !important;
        font-size: 0.875rem !important;
    }
    
    /* Metadata */
    .recipe-metadata {
        flex-direction: column !important;
        gap: 0.5rem !important;
        align-items: flex-start !important;
    }
    
    .metadata-item {
        width: 100%;
        justify-content: flex-start !important;
    }
    
    /* Voice button */
    .voice-button {
        width: 60px !important;
        height: 60px !important;
        bottom: 1rem !important;
        right: 1rem !important;
    }
    
    /* Modals and popups */
    .modal-content,
    .share-dropdown {
        width: 90% !important;
        max-width: 400px !important;
        margin: 0 auto !important;
    }
    
    /* Filters */
    .filter-chips {
        flex-wrap: wrap;
        gap: 0.5rem !important;
    }
    
    .filter-chip {
        font-size: 0.75rem !important;
        padding: 0.5rem 0.875rem !important;
    }
    
    /* Recommendations section */
    .recommendation-cards {
        grid-template-columns: 1fr !important;
        gap: 0.75rem !important;
    }
    
    /* Bottom spacing for voice button */
    body {
        padding-bottom: 5rem !important;
    }
}

/* Extra small screens (< 375px) */
@media (max-width: 375px) {
    header h1 {
        font-size: 1rem !important;
    }
    
    .hero-title {
        font-size: 1.5rem !important;
    }
    
    .cuisine-grid {
        grid-template-columns: 1fr !important;
    }
    
    header button {
        padding: 0.4rem 0.6rem !important;
    }
}
/* Landscape mode on mobile */
@media (max-height: 500px) and (orientation: landscape) {
    .hero-section {
        padding: 1rem !important;
    }
    .hero-title {
        font-size: 1.25rem !important;
    }
    
    .cuisine-grid {
        grid-template-columns: repeat(4, 1fr) !important;
    }
}

    </style>
</head>
<body class="bg-gradient-to-br from-orange-50 via-yellow-50 to-red-50 min-h-screen">
<header class="glass-effect sticky top-0 z-50 shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="bg-white p-2 rounded-2xl shadow-lg">
                        <img src="namak_logo.png" alt="Namak Shamak Logo" class="w-12 h-12 object-contain">
                    </div>
                    <div>
                        <h1 class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent">
                            Namak Shamak
                        </h1>
                        <p class="text-xs sm:text-sm text-gray-600">Powered by Duna AI</p>
                    </div>
                </div>
                
                <div class="flex items-center gap-3 sm:gap-4">
                    <div class="saved-recipes-btn relative">
                        <button id="savedRecipesBtn" class="relative bg-gradient-to-r from-orange-500 to-red-500 text-white px-4 py-2 rounded-xl font-semibold hover:shadow-lg transition-all flex items-center gap-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"/>
                            </svg>
                            <span class="hidden sm:inline">Saved</span>
                            <span id="savedCount" class="badge-count hidden">0</span>
                        </button>
                        
                        <div id="savedRecipesDropdown" class="saved-recipes-dropdown">
                            <div class="p-4 border-b border-orange-200">
                                <h3 class="text-lg font-bold text-gray-800">My Saved Recipes 💾</h3>
                                <p class="text-sm text-gray-600">Click to view full recipe</p>
                            </div>
                            <div id="savedRecipesList" class="p-4">
                                <p class="text-center text-gray-500 py-8">No saved recipes yet! Start exploring and save your favorites.</p>
                            </div>
                        </div>
                    </div>

                    <div class="shopping-list-btn relative">
                        <button id="shoppingListBtn" class="relative bg-gradient-to-r from-green-500 to-emerald-600 text-white px-4 py-2 rounded-xl font-semibold hover:shadow-lg transition-all flex items-center gap-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"/>
                            </svg>
                            <span class="hidden sm:inline">List</span>
                            <span id="shoppingCount" class="badge-count hidden">0</span>
                        </button>
                        
                        <div id="shoppingListDropdown" class="shopping-list-dropdown">
                            <div class="p-4 border-b border-orange-200">
                                <h3 class="text-lg font-bold text-gray-800">Shopping List 🛒</h3>
                                <p class="text-sm text-gray-600">Check off items as you shop</p>
                            </div>
                            <div id="shoppingItemsList" class="p-4">
                                <p class="text-center text-gray-500 py-8">No items in your shopping list yet!</p>
                            </div>
                            <div id="shoppingActionsContainer" class="hidden px-4 pb-4">
                                <div class="shopping-actions">
                                    <button id="clearCompletedBtn" class="shopping-action-btn clear-completed">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                        </svg>
                                        Clear Done
                                    </button>
                                    <button id="clearAllBtn" class="shopping-action-btn clear-all">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                        </svg>
                                        Clear All
                                    </button>
                                    <button id="printListBtn" class="shopping-action-btn print-list">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
                                        </svg>
                                        Print
                                    </button>
                                    <button id="copyListBtn" class="shopping-action-btn copy-list">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                        </svg>
                                        Copy
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Search History Button -->
<div class="search-history-btn relative">
    <button id="searchHistoryBtn" class="relative bg-gradient-to-r from-purple-500 to-indigo-600 text-white px-4 py-2 rounded-xl font-semibold hover:shadow-lg transition-all flex items-center gap-2" aria-label="View search history">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <span class="hidden sm:inline">History</span>
        <span id="historyCount" class="badge-count hidden">0</span>
    </button>
    
    <!-- Dropdown -->
    <div id="searchHistoryDropdown" class="search-history-dropdown">
        <div class="history-header">
            <h3>🔍 Search History</h3>
            <button id="clearHistoryBtn" class="history-clear-btn">Clear All</button>
        </div>
        <div id="searchHistoryList"></div>
    </div>
</div>
 <!-- PWA Install Button -->
            <button id="installBtn" class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-4 py-2 rounded-xl font-semibold hover:shadow-lg transition-all flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                </svg>
                <span class="hidden sm:inline">Install</span>
            </button>
                    
                    <div class="dark-mode-toggle" id="darkModeToggle">
                        <div class="dark-mode-toggle-circle">
                            <span id="darkModeIcon">🌙</span>
                        </div>
                    </div>
                    
                    <button id="backToHome" class="hidden bg-gradient-to-r from-gray-600 to-gray-700 text-white px-4 py-2 rounded-xl font-semibold hover:shadow-lg transition-all">
                        ← Back
                    </button>
                </div>
            </div>
        </div>
</header>
    <section id="heroSection" class="max-w-7xl mx-auto px-4 py-12">
        <div class="text-center mb-12 fade-in-up">
            <h2 class="text-4xl sm:text-5xl md:text-6xl font-bold text-gray-800 mb-4">
                Discover Your Perfect Recipe 🍽️
            </h2>
            <p class="text-lg sm:text-xl text-gray-600 max-w-2xl mx-auto">
                Explore cuisines from around the world and get AI-generated recipes tailored to your taste
            </p>
        </div>

        <div class="max-w-3xl mx-auto mb-16 fade-in-up">
            <div class="bg-white rounded-3xl shadow-2xl p-4 sm:p-6 border-2 border-orange-100">
                <div class="flex gap-3">
                    <input
                        type="text"
                        id="quickSearch"
                        placeholder="Search any dish... (e.g., Butter Chicken, Pizza)"
                        class="flex-1 px-6 py-4 text-lg border-2 border-gray-200 rounded-2xl focus:outline-none focus:border-orange-400 focus:ring-4 focus:ring-orange-100 transition-all"
                    />
                    <button
                        id="quickSearchBtn"
                        class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-8 py-4 rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all"
                    >
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <!-- AI Recipe from Ingredients -->
<div class="ingredients-generator">
    <div class="ingredients-header">
        🧠 Have Ingredients? Generate Recipe!
    </div>
    <p style="color: #92400e; margin-bottom: 1rem; font-size: 0.875rem;">
        Enter what ingredients you have, and AI will create a recipe for you!
    </p>
    
    <div class="ingredients-input-container">
        <input 
            type="text" 
            id="ingredientsInput" 
            class="ingredients-input"
            placeholder="Type an ingredient and press Enter (e.g., chicken, tomatoes, rice...)"
        >
    </div>
    
    <div id="ingredientTags" class="ingredient-tags"></div>
    
    <button id="generateFromIngredientsBtn" class="generate-recipe-btn" disabled>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
        Generate Recipe from Ingredients
    </button>
    
    <div class="quick-ingredients">
        <div class="quick-ingredients-label">🔥 Quick Add:</div>
        <div class="quick-ingredient-chips">
            <span class="quick-ingredient-chip" data-ingredient="chicken">🍗 Chicken</span>
            <span class="quick-ingredient-chip" data-ingredient="rice">🍚 Rice</span>
            <span class="quick-ingredient-chip" data-ingredient="tomatoes">🍅 Tomatoes</span>
            <span class="quick-ingredient-chip" data-ingredient="onion">🧅 Onion</span>
            <span class="quick-ingredient-chip" data-ingredient="garlic">🧄 Garlic</span>
            <span class="quick-ingredient-chip" data-ingredient="potatoes">🥔 Potatoes</span>
            <span class="quick-ingredient-chip" data-ingredient="eggs">🥚 Eggs</span>
            <span class="quick-ingredient-chip" data-ingredient="cheese">🧀 Cheese</span>
            <span class="quick-ingredient-chip" data-ingredient="pasta">🍝 Pasta</span>
            <span class="quick-ingredient-chip" data-ingredient="vegetables">🥗 Vegetables</span>
        </div>
    </div>
</div>
<!-- Recipe Recommendations -->
<div id="recommendationsSection" class="recommendations-section hidden">
    <div class="recommendations-header">
        🌟 Recommended For You
    </div>
    <p style="color: #92400e; margin-bottom: 1rem; font-size: 0.875rem;">
        Based on your recent searches
    </p>
    <div id="recommendationCards" class="recommendation-cards"></div>
</div>

        <div class="mb-12">
            <h3 class="text-3xl font-bold text-gray-800 mb-8 text-center">Explore Cuisines 🌍</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="cuisine-card bg-gradient-to-br from-orange-400 to-red-500 rounded-3xl p-6 shadow-xl cursor-pointer" data-cuisine="Indian">
    <div class="text-6xl mb-4">🇮🇳</div>
    <h4 class="text-2xl font-bold text-white mb-2">Indian</h4>
    <p class="text-orange-50 text-sm">Spicy, aromatic & flavorful</p>
</div>


            <div class="cuisine-card bg-gradient-to-br from-green-400 to-emerald-600 rounded-3xl p-6 shadow-xl cursor-pointer" data-cuisine="Italian">
    <div class="text-6xl mb-4">🇮🇹</div>
    <h4 class="text-2xl font-bold text-white mb-2">Italian</h4>
    <p class="text-green-50 text-sm">Pasta, pizza & more</p>
</div>

         <div class="cuisine-card bg-gradient-to-br from-red-400 to-pink-600 rounded-3xl p-6 shadow-xl cursor-pointer" data-cuisine="Chinese">
    <div class="text-6xl mb-4">🇨🇳</div>
    <h4 class="text-2xl font-bold text-white mb-2">Chinese</h4>
    <p class="text-red-50 text-sm">Savory & umami-rich</p>
</div>


           <div class="cuisine-card bg-gradient-to-br from-yellow-400 to-orange-600 rounded-3xl p-6 shadow-xl cursor-pointer" data-cuisine="Mexican">
    <div class="text-6xl mb-4">🇲🇽</div>
    <h4 class="text-2xl font-bold text-white mb-2">Mexican</h4>
    <p class="text-yellow-50 text-sm">Bold & zesty flavors</p>
</div>


             <div class="cuisine-card bg-gradient-to-br from-blue-400 to-indigo-600 rounded-3xl p-6 shadow-xl cursor-pointer" data-cuisine="Japanese">
    <div class="text-6xl mb-4">🇯🇵</div>
    <h4 class="text-2xl font-bold text-white mb-2">Japanese</h4>
    <p class="text-blue-50 text-sm">Fresh & delicate</p>
</div>

        <div class="cuisine-card bg-gradient-to-br from-purple-400 to-pink-600 rounded-3xl p-6 shadow-xl cursor-pointer" data-cuisine="Thai">
    <div class="text-6xl mb-4">🇹🇭</div>
    <h4 class="text-2xl font-bold text-white mb-2">Thai</h4>
    <p class="text-purple-50 text-sm">Sweet, sour & spicy</p>
</div>

           <div class="cuisine-card bg-gradient-to-br from-teal-400 to-cyan-600 rounded-3xl p-6 shadow-xl cursor-pointer" data-cuisine="Mediterranean">
    <div class="text-6xl mb-4">🌊</div>
    <h4 class="text-2xl font-bold text-white mb-2">Mediterranean</h4>
    <p class="text-teal-50 text-sm">Healthy & fresh</p>
</div>

<div class="cuisine-card bg-gradient-to-br from-gray-600 to-gray-800 rounded-3xl p-6 shadow-xl cursor-pointer" data-cuisine="American">
    <div class="text-6xl mb-4">🇺🇸</div>
    <h4 class="text-2xl font-bold text-white mb-2">American</h4>
    <p class="text-gray-50 text-sm">Comfort food classics</p>
</div>
        </div>
    </section>

    <section id="filterSection" class="hidden max-w-7xl mx-auto px-4 py-8">
        <div class="bg-white rounded-3xl shadow-2xl p-6 sm:p-8 border-2 border-orange-100 mb-8">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl sm:text-3xl font-bold text-gray-800">
                    <span id="selectedCuisineTitle">Indian</span> Cuisine
                </h3>
            </div>

            <div class="mb-6">
                <p class="text-sm font-semibold text-gray-600 mb-3">Filter by:</p>
                <div class="flex flex-wrap gap-3">
                    <div class="filter-chip active bg-gray-100 px-5 py-2.5 rounded-full font-medium text-gray-700" data-filter="Most Popular">
                        ⭐ Most Popular
                    </div>
                    <div class="filter-chip bg-gray-100 px-5 py-2.5 rounded-full font-medium text-gray-700" data-filter="Most Spicy">
                        🌶️ Most Spicy
                    </div>
                    <div class="filter-chip bg-gray-100 px-5 py-2.5 rounded-full font-medium text-gray-700" data-filter="Sweet">
                        🍯 Sweet
                    </div>
                    <div class="filter-chip bg-gray-100 px-5 py-2.5 rounded-full font-medium text-gray-700" data-filter="Healthy">
                        🥗 Healthy
                    </div>
                    <div class="filter-chip bg-gray-100 px-5 py-2.5 rounded-full font-medium text-gray-700" data-filter="Quick & Easy">
                        ⚡ Quick & Easy
                    </div>
                    <div class="filter-chip bg-gray-100 px-5 py-2.5 rounded-full font-medium text-gray-700" data-filter="Vegetarian">
                        🌱 Vegetarian
                    </div>
                    <div class="filter-chip bg-gray-100 px-5 py-2.5 rounded-full font-medium text-gray-700" data-filter="Desserts">
                        🍰 Desserts
                    </div>
</div>
                </div>
            </div>

            <div>
                <h4 class="text-xl font-bold text-gray-700 mb-4">Popular Dishes</h4>
                <div class="popular-dishes-scroll gap-4" id="popularDishes">
                    </div>
            </div>
        </div>

        <div class="bg-white rounded-3xl shadow-2xl p-6 sm:p-8 border-2 border-orange-100">
            <h4 class="text-xl font-bold text-gray-700 mb-4">Or Enter Your Own Dish</h4>
            <div class="space-y-4">
                <input
                    type="text"
                    id="customDish"
                    placeholder="Enter dish name..."
                    class="w-full px-6 py-4 text-lg border-2 border-gray-200 rounded-2xl focus:outline-none focus:border-orange-400 focus:ring-4 focus:ring-orange-100 transition-all"
                />
<div class="hinglish-bar flex items-center gap-3 bg-gradient-to-r from-orange-50 to-yellow-50 p-4 rounded-2xl">                    <input
                        type="checkbox"
                        id="hinglish"
                        class="w-5 h-5 text-orange-500 rounded focus:ring-orange-400"
                    />
                    <label for="hinglish" class="text-gray-700 font-medium cursor-pointer">
                        Generate recipe in Hinglish (Hindi + English)
                    </label>
                </div>
                <button
                    id="generateCustomBtn"
                    class="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-4 px-8 rounded-2xl font-semibold text-lg shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-3"
                >
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    Generate Recipe
                </button>
            </div>
        </div>
    </section>

    <div id="loadingContainer" class="loading-container hidden">
    <div class="loading-chef">
        <div class="chef-hat">👨‍🍳</div>
        <div class="loading-text">
            <h3 class="text-2xl font-bold text-orange-500 mb-2">Cooking up your recipe...</h3>
            <p class="text-gray-600" id="loadingSubtext">AI is creating something delicious!</p>
        </div>
        <div class="loading-bar-container">
            <div class="loading-bar-fill"></div>
        </div>
        <div class="cooking-icons">
            <span class="cooking-icon">🥘</span>
            <span class="cooking-icon">🍳</span>
            <span class="cooking-icon">🔪</span>
            <span class="cooking-icon">🧂</span>
        </div>
    </div>
</div>
    <div id="errorContainer" class="hidden max-w-4xl mx-auto px-4 mb-8">
        <div class="bg-red-50 border-2 border-red-200 rounded-2xl p-6">
            <p id="errorMessage" class="text-red-700 font-medium"></p>
        </div>
    </div>
    <div id="recipeContainer" class="hidden max-w-5xl mx-auto px-4 py-8">
        <div class="bg-white rounded-3xl shadow-2xl overflow-hidden border-2 border-orange-100">
            <div class="p-6 sm:p-8">
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6 pb-6 border-b-2 border-gray-100">
    <div class="flex items-center gap-3 flex-wrap">
        <h2 id="recipeDishName" class="text-3xl sm:text-4xl font-bold text-gray-800"></h2>
        <span id="difficultyBadge" class="difficulty-badge hidden"></span>
    </div>
                    <div class="flex gap-2 flex-wrap">
                        <button id="saveRecipeBtn" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-4 sm:px-6 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all flex items-center gap-2">
                            <svg id="saveIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
                            </svg>
                            <span id="saveText">Save</span>
                        </button>
                        <button id="addToListBtn" class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-4 sm:px-6 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all flex items-center gap-2">
                            <svg id="listIcon" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"/>
                            </svg>
                            <span id="listText">Add to List</span>
                        </button>
                    </div>
                </div>
                
                <div class="recipe-metadata">
        <div class="metadata-item">
            <svg class="metadata-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span class="metadata-label">Prep:</span>
            <span id="prepTime">15 mins</span>
        </div>
        <div class="metadata-item">
            <svg class="metadata-icon" fill="currentColor" viewBox="0 0 20 20">
                <path d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z"/>
            </svg>
            <span class="metadata-label">Cook:</span>
            <span id="cookTime">30 mins</span>
        </div>
        <div class="metadata-item">
            <svg class="metadata-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
            </svg>
            <span class="metadata-label">Serves:</span>
            <span id="servings">4</span>
        </div>
    </div>
    <!-- Nutritional Information -->
<div id="nutritionContainer" class="nutrition-container hidden">
    <div class="nutrition-header">
        🥗 Nutrition Facts
        <span style="font-size: 0.875rem; font-weight: normal; color: #6b7280;">(per serving)</span>
    </div>
    
    <div class="nutrition-grid">
        <div class="nutrition-item">
            <span class="nutrition-value" id="nutritionCalories">450</span>
            <span class="nutrition-label">Calories</span>
        </div>
        <div class="nutrition-item">
            <span class="nutrition-value" id="nutritionProtein">35g</span>
            <span class="nutrition-label">Protein</span>
        </div>
        <div class="nutrition-item">
            <span class="nutrition-value" id="nutritionCarbs">28g</span>
            <span class="nutrition-label">Carbs</span>
        </div>
        <div class="nutrition-item">
            <span class="nutrition-value" id="nutritionFat">22g</span>
            <span class="nutrition-label">Fat</span>
        </div>
    </div>
    
    <!-- Dietary Tags -->
    <div id="dietaryTagsContainer" class="dietary-tags hidden"></div>
    
    <!-- Allergen Warning -->
    <div id="allergenWarning" class="allergen-warning hidden">
        <div class="allergen-icon">⚠️</div>
        <div class="allergen-content">
            <div class="allergen-title">Allergen Warning</div>
            <div class="allergen-list" id="allergenList">Contains: Dairy, Nuts</div>
        </div>
    </div>
    
    <!-- Health Score -->
    <div class="health-score">
        <span class="health-score-label">Health Score:</span>
        <span class="health-score-stars" id="healthScoreStars">⭐⭐⭐⭐⭐⭐⭐</span>
        <span class="health-score-value" id="healthScoreValue">(7/10)</span>
    </div>
</div>

                
                <div id="recipeText" class="recipe-text"></div>
                <!-- Recipe Variations & Substitutions -->
<div id="variationsContainer" class="variations-container hidden">
    <div class="variations-header">
        🔄 Recipe Variations
    </div>
    
    <div class="variation-buttons">
        <button class="variation-btn vegan" id="makeVeganBtn">
            🌱 Make it Vegan
        </button>
        <button class="variation-btn spicy" id="makeSpicyBtn">
            🌶️ Extra Spicy
        </button>
        <button class="variation-btn healthy" id="makeHealthyBtn">
            🥗 Healthier Version
        </button>
        <button class="variation-btn budget" id="makeBudgetBtn">
            💰 Budget-Friendly
        </button>
    </div>
    
    <!-- Substitutions Section -->
    <div class="substitutions-section">
        <h4 style="font-weight: 700; color: #7c3aed; margin-bottom: 0.75rem;">💡 Ingredient Substitutions:</h4>
        <div id="substitutionsList"></div>
    </div>
</div>

<!-- Related Recipes -->
<div id="relatedRecipesContainer" class="related-recipes hidden">
    <div class="related-recipes-header">
        🍽️ You Might Also Like
    </div>
    <div id="relatedRecipesList" class="related-recipe-grid"></div>
</div>

                <div class="print-btn-container">
                    <button
                        id="printRecipeBtn"
                        class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white py-3 px-8 rounded-2xl font-semibold text-lg shadow-lg hover:shadow-xl transition-all flex items-center gap-2"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
                        </svg>
                        Print Recipe
                    </button>
                    <!-- Share Button -->
<!-- Share Button -->
<button id="shareBtn" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 px-8 rounded-2xl font-semibold text-lg shadow-lg hover:shadow-xl transition-all flex items-center gap-2">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
    </svg>
    Share Recipe
</button>

<!-- Share Modal (Simple Full-Screen) -->
<div id="shareModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden items-center justify-center z-50" style="display: none;">
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-md w-full mx-4 shadow-2xl">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-2xl font-bold text-gray-800 dark:text-white">Share Recipe</h3>
            <button id="closeShareModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-400">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
            </button>
        </div>
        
        <div class="space-y-3">
            <button class="share-option w-full" id="shareWhatsApp">
                <span style="font-size: 1.5rem;">💬</span>
                <span>WhatsApp</span>
            </button>
            <button class="share-option w-full" id="shareTwitter">
                <span style="font-size: 1.5rem;">🐦</span>
                <span>Twitter</span>
            </button>
            <button class="share-option w-full" id="shareFacebook">
                <span style="font-size: 1.5rem;">👤</span>
                <span>Facebook</span>
            </button>
            <button class="share-option w-full" id="shareCopy">
                <span style="font-size: 1.5rem;">📋</span>
                <span>Copy Link</span>
            </button>
        </div>
    </div>
</div>

                    <button
    id="startCookingModeBtn"
    class="bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 px-8 rounded-2xl font-semibold text-lg shadow-lg hover:shadow-xl transition-all flex items-center gap-2"
>
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
    </svg>
    Start Cooking Mode
</button>
                    <button
                        id="newRecipeBtn"
                        class="bg-gradient-to-r from-orange-500 to-red-500 text-white py-3 px-8 rounded-2xl font-semibold text-lg shadow-lg hover:shadow-xl transition-all"
                    >
                        🔄 Generate Another Recipe
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="timerWidget" class="timer-widget hidden">
        <div id="timerMinimized" class="timer-widget-minimized hidden">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
            </svg>
            <span id="timerCountBadge">Timers</span>
            <span class="timer-badge" id="activeTimerCount">0</span>
        </div>

        <div id="timerExpanded" class="timer-widget-expanded hidden">
            <div class="timer-header">
                <h3 class="text-xl font-bold text-gray-800">Active Timers ⏱️</h3>
                <button id="closeTimerWidget" class="text-gray-500 hover:text-gray-700 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div id="timersList">
                <p class="text-center text-gray-500 py-4">No active timers</p>
            </div>
        </div>
    </div>

    <div id="timerNotification" class="timer-notification hidden">
        <div class="text-6xl mb-4">⏰</div>
        <h2 class="text-2xl font-bold text-gray-800 mb-2">Timer Complete!</h2>
        <p id="timerNotificationText" class="text-lg text-gray-600 mb-4"></p>
        <button id="dismissTimerNotification" class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-2 rounded-xl font-semibold">
            Dismiss
        </button>
    </div>

    <footer class="text-center py-8 text-gray-500 mt-12">
        <p>© Made by Harshit • Duna - Your Personal AI Assistant</p>
    </footer>
    <!-- Cooking Mode Overlay -->
<div id="cookingModeOverlay" class="cooking-mode-overlay">
    <!-- Header -->
    <div class="cooking-mode-header">
        <button id="cookingModeExit" class="cooking-mode-exit">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
            Exit Cooking Mode
        </button>
        
        <div class="cooking-mode-progress">
            <span id="cookingModeCurrentStep">1</span> of <span id="cookingModeTotalSteps">8</span>
        </div>
        
        <button id="cookingModeSkip" class="cooking-mode-next">
            Skip to End
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"/>
            </svg>
        </button>
    </div>
    
    <!-- Content -->
    <div class="cooking-mode-content">
        <div class="cooking-mode-step-container">
            <div class="cooking-mode-step-number">STEP <span id="cookingModeStepNum">1</span></div>
            
            <!-- Progress Bar -->
            <div class="cooking-mode-progress-bar">
                <div id="cookingModeProgressFill" class="cooking-mode-progress-fill" style="width: 0%"></div>
            </div>
            
            <div id="cookingModeStepText" class="cooking-mode-step-text">
                Loading step...
            </div>
            
            <div class="cooking-mode-actions">
                <button id="cookingModeTimerBtn" class="cooking-mode-action-btn timer hidden">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                    </svg>
                    Start Timer
                </button>
                
                <button id="cookingModeIngredientsBtn" class="cooking-mode-action-btn ingredients">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                    </svg>
                    View Ingredients
                </button>
            </div>
        </div>
    </div>
    
    <!-- Footer Navigation -->
    <div class="cooking-mode-footer">
        <button id="cookingModePrevBtn" class="cooking-mode-nav-btn prev" disabled>
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            Previous
        </button>
        
        <button id="cookingModeNextBtn" class="cooking-mode-nav-btn next">
            Next
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
        </button>
    </div>
    
    <!-- Ingredients Popup -->
    <div id="cookingModeIngredientsPopup" class="cooking-mode-ingredients-popup">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-2xl font-bold text-gray-800">Ingredients</h3>
            <button id="closeIngredientsPopup" class="text-gray-500 hover:text-gray-700">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div id="cookingModeIngredientsList"></div>
    </div>
</div>
<!-- Voice Assistant Button -->
<button id="voiceBtn" class="voice-button" aria-label="Voice Assistant">
    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
    </svg>
</button>

<!-- Voice Overlay -->
<div id="voiceOverlay" class="voice-overlay">
    <div class="voice-container">
        <div class="voice-status" id="voiceStatus">🎤 Listening...</div>
        <div class="voice-transcript" id="voiceTranscript">Say something...</div>
        
        <div class="voice-animation">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        
        <button id="closeVoice" class="bg-red-500 text-white px-6 py-3 rounded-xl font-semibold hover:bg-red-600 transition-all">
            Stop Listening
        </button>
        
        <div class="voice-commands">
            <strong>Try saying:</strong>
            <div class="voice-command-item">"Search for Butter Chicken"</div>
            <div class="voice-command-item">"Show me Italian recipes"</div>
            <div class="voice-command-item">"Next step" (in cooking mode)</div>
            <div class="voice-command-item">"Read the recipe"</div>
        </div>
    </div>
</div>
    <script>
    // ============================================
    // CONFIGURATION & CONSTANTS
    // ============================================
    
    // ⚠️ IMPORTANT: Move this to environment variable or backend in production
   const API_key = "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";
    const API_URL = "https://api.groq.com/openai/v1/chat/completions";
    // ============================================
// MULTI-LANGUAGE SUPPORT (i18n)
// ============================================

const translations = {
    en: {
        // Header
        appName: "Namak Shamak",
        savedRecipes: "Saved",
        shoppingList: "Shopping",
        history: "History",
        install: "Install",
        darkMode: "🌙",
        
        // Hero
        heroTitle: "Discover Delicious Recipes",
        heroSubtitle: "AI-powered recipe assistant for home cooks",
        searchPlaceholder: "Search for a recipe... (e.g., Butter Chicken)",
        searchBtn: "🔍 Search Recipe",
        hinglishBtn: "हिंग्लिश में",
        
        // Cuisines
        exploreCuisines: "🌍 Explore Cuisines",
        indian: "Indian",
        italian: "Italian",
        chinese: "Chinese",
        mexican: "Mexican",
        japanese: "Japanese",
        thai: "Thai",
        mediterranean: "Mediterranean",
        american: "American",
        
        // Ingredients Generator
        ingredientsTitle: "🧠 Have Ingredients? Generate Recipe!",
        ingredientsDesc: "Enter what ingredients you have, and AI will create a recipe for you!",
        ingredientsPlaceholder: "Type an ingredient and press Enter...",
        generateBtn: "Generate Recipe from Ingredients",
        quickAdd: "🔥 Quick Add:",
        
        // Recipe Display
        prepTime: "Prep:",
        cookTime: "Cook:",
        serves: "Serves:",
        ingredients: "Ingredients",
        instructions: "Instructions",
        
        // Buttons
        printRecipe: "Print Recipe",
        shareRecipe: "Share Recipe",
        startCooking: "Start Cooking Mode",
        generateAnother: "Generate Another Recipe",
        saveRecipe: "💾 Save Recipe",
        
        // Notifications
        recipeSaved: "✓ Recipe saved successfully!",
        recipeRemoved: "Recipe removed from saved",
        linkCopied: "✓ Link copied to clipboard!",
        
        // Loading
        loadingTitle: "Cooking up your recipe...",
        loadingSubtext: "AI is creating something delicious!",
        
        // Recommendations
        recommendedTitle: "🌟 Recommended For You",
        recommendedDesc: "Based on your recent searches"
    },
    
    hi: {
        // Header
        appName: "नमक शमक",
        savedRecipes: "सेव किए गए",
        shoppingList: "शॉपिंग",
        history: "हिस्ट्री",
        install: "इंस्टॉल",
        darkMode: "🌙",
        
        // Hero
        heroTitle: "स्वादिष्ट रेसिपी खोजें",
        heroSubtitle: "घर के रसोइयों के लिए AI रेसिपी असिस्टेंट",
        searchPlaceholder: "रेसिपी सर्च करें... (जैसे, बटर चिकन)",
        searchBtn: "🔍 रेसिपी खोजें",
        hinglishBtn: "English में",
        
        // Cuisines
        exploreCuisines: "🌍 व्यंजन चुनें",
        indian: "भारतीय",
        italian: "इटालियन",
        chinese: "चाइनीज",
        mexican: "मेक्सिकन",
        japanese: "जापानी",
        thai: "थाई",
        mediterranean: "मेडिटरेनियन",
        american: "अमेरिकन",
        
        // Ingredients Generator
        ingredientsTitle: "🧠 सामग्री है? रेसिपी बनाएं!",
        ingredientsDesc: "अपनी सामग्री डालें, AI आपके लिए रेसिपी बनाएगा!",
        ingredientsPlaceholder: "सामग्री टाइप करें और एंटर दबाएं...",
        generateBtn: "सामग्री से रेसिपी बनाएं",
        quickAdd: "🔥 जल्दी जोड़ें:",
        
        // Recipe Display
        prepTime: "तैयारी:",
        cookTime: "पकाना:",
        serves: "परोसें:",
        ingredients: "सामग्री",
        instructions: "निर्देश",
        
        // Buttons
        printRecipe: "प्रिंट करें",
        shareRecipe: "शेयर करें",
        startCooking: "कुकिंग मोड शुरू करें",
        generateAnother: "नई रेसिपी बनाएं",
        saveRecipe: "💾 सेव करें",
        
        // Notifications
        recipeSaved: "✓ रेसिपी सेव हो गई!",
        recipeRemoved: "रेसिपी हटा दी गई",
        linkCopied: "✓ लिंक कॉपी हो गया!",
        
        // Loading
        loadingTitle: "आपकी रेसिपी बन रही है...",
        loadingSubtext: "AI कुछ स्वादिष्ट बना रहा है!",
        
        // Recommendations
        recommendedTitle: "🌟 आपके लिए सुझाव",
        recommendedDesc: "आपकी हाल की खोजों के आधार पर"
    },
    
    es: {
        // Header
        appName: "Namak Shamak",
        savedRecipes: "Guardados",
        shoppingList: "Compras",
        history: "Historial",
        install: "Instalar",
        darkMode: "🌙",
        
        // Hero
        heroTitle: "Descubre Recetas Deliciosas",
        heroSubtitle: "Asistente de recetas con IA para cocineros caseros",
        searchPlaceholder: "Buscar una receta... (ej., Pollo con Mantequilla)",
        searchBtn: "🔍 Buscar Receta",
        hinglishBtn: "En Hindi",
        
        // Cuisines
        exploreCuisines: "🌍 Explorar Cocinas",
        indian: "India",
        italian: "Italiana",
        chinese: "China",
        mexican: "Mexicana",
        japanese: "Japonesa",
        thai: "Tailandesa",
        mediterranean: "Mediterránea",
        american: "Americana",
        
        // Ingredients Generator
        ingredientsTitle: "🧠 ¿Tienes Ingredientes? ¡Genera Receta!",
        ingredientsDesc: "Ingresa los ingredientes que tienes, ¡la IA creará una receta para ti!",
        ingredientsPlaceholder: "Escribe un ingrediente y presiona Enter...",
        generateBtn: "Generar Receta con Ingredientes",
        quickAdd: "🔥 Agregar Rápido:",
        
        // Recipe Display
        prepTime: "Prep:",
        cookTime: "Cocinar:",
        serves: "Porciones:",
        ingredients: "Ingredientes",
        instructions: "Instrucciones",
        
        // Buttons
        printRecipe: "Imprimir Receta",
        shareRecipe: "Compartir Receta",
        startCooking: "Modo Cocina",
        generateAnother: "Otra Receta",
        saveRecipe: "💾 Guardar",
        
        // Notifications
        recipeSaved: "✓ ¡Receta guardada!",
        recipeRemoved: "Receta eliminada",
        linkCopied: "✓ ¡Enlace copiado!",
        
        // Loading
        loadingTitle: "Preparando tu receta...",
        loadingSubtext: "¡La IA está creando algo delicioso!",
        
        // Recommendations
        recommendedTitle: "🌟 Recomendado Para Ti",
        recommendedDesc: "Basado en tus búsquedas recientes"
    }
};

let currentLanguage = localStorage.getItem('language') || 'en';

function t(key) {
    return translations[currentLanguage][key] || translations.en[key] || key;
}

function setLanguage(lang) {
    currentLanguage = lang;
    localStorage.setItem('language', lang);
    updateUILanguage();
}

function updateUILanguage() {
    // Update all translatable elements
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (el.placeholder !== undefined) {
            el.placeholder = t(key);
        } else {
            el.textContent = t(key);
        }
    });
}
    const NOTIFICATION_DURATION_MS = 3000;
    const REQUEST_TIMEOUT_MS = 30000;
    const MAX_DISH_NAME_LENGTH = 100;
    
    // ============================================
    // STATE MANAGEMENT
    // ============================================
    
    let currentCuisine = "";
    let currentFilter = "Most Popular";
    let currentRecipe = null;
    let activeTimers = [];
    let timerIdCounter = 0;
    let searchTimeout = null;

    // ============================================
    // UTILITY FUNCTIONS
    // ============================================
    
    function showNotification(message, type = 'success') {
        const colors = {
            success: 'bg-green-500',
            error: 'bg-red-500',
            info: 'bg-blue-500',
            warning: 'bg-yellow-500'
        };
        
        const notification = document.createElement('div');
        notification.className = `fixed top-20 right-4 ${colors[type]} text-white px-6 py-3 rounded-xl shadow-lg z-50 animate-fadeIn`;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.opacity = '0';
            notification.style.transition = 'opacity 0.3s';
            setTimeout(() => notification.remove(), 300);
        }, NOTIFICATION_DURATION_MS);
    }
    
    function sanitizeInput(input) {
        return input.trim().replace(/[<>]/g, '').substring(0, MAX_DISH_NAME_LENGTH);
    }
    
    function validateDishName(dishName) {
        if (!dishName || dishName.length === 0) {
            showNotification('Please enter a dish name', 'warning');
            return false;
        }
        
        if (dishName.length > MAX_DISH_NAME_LENGTH) {
            showNotification(`Dish name too long (max ${MAX_DISH_NAME_LENGTH} characters)`, 'warning');
            return false;
        }
        
        return true;
    }

    // ============================================
    // DARK MODE
    // ============================================
    
    const darkModeToggle = document.getElementById('darkModeToggle');
    const darkModeIcon = document.getElementById('darkModeIcon');
    const body = document.body;

    // Load saved preference
    if (localStorage.getItem('darkMode') === 'enabled') {
        body.classList.add('dark-mode');
        darkModeIcon.textContent = '☀️';
    }

    darkModeToggle.addEventListener('click', () => {
        body.classList.toggle('dark-mode');
        
        if (body.classList.contains('dark-mode')) {
            darkModeIcon.textContent = '☀️';
            localStorage.setItem('darkMode', 'enabled');
        } else {
            darkModeIcon.textContent = '🌙';
            localStorage.setItem('darkMode', 'disabled');
        }
    });

    // ============================================
    // SAVED RECIPES MANAGEMENT (with error handling)
    // ============================================
    
    function getSavedRecipes() {
        try {
            const saved = localStorage.getItem('savedRecipes');
            if (!saved) return [];
            
            const parsed = JSON.parse(saved);
            return Array.isArray(parsed) ? parsed : [];
        } catch (error) {
            console.error('Failed to load saved recipes:', error);
            localStorage.removeItem('savedRecipes');
            showNotification('Error loading saved recipes', 'error');
            return [];
        }
    }

    function saveRecipe(recipe) {
        try {
            const savedRecipes = getSavedRecipes();
            const exists = savedRecipes.find(r => r.dishName === recipe.dishName);
            if (exists) return false;
            
            savedRecipes.push({
                dishName: recipe.dishName,
                recipeText: recipe.recipeText,
                difficulty: recipe.difficulty || 'Medium',
                prepTime: recipe.prepTime || '15 mins',
                cookTime: recipe.cookTime || '30 mins',
                servings: recipe.servings || '4',
                savedAt: new Date().toISOString()
            });
            
            localStorage.setItem('savedRecipes', JSON.stringify(savedRecipes));
            updateSavedRecipesUI();
            return true;
        } catch (error) {
            console.error('Failed to save recipe:', error);
            showNotification('Error saving recipe', 'error');
            return false;
        }
    }

    function deleteRecipe(dishName) {
        try {
            let savedRecipes = getSavedRecipes();
            savedRecipes = savedRecipes.filter(r => r.dishName !== dishName);
            localStorage.setItem('savedRecipes', JSON.stringify(savedRecipes));
            updateSavedRecipesUI();
        } catch (error) {
            console.error('Failed to delete recipe:', error);
            showNotification('Error deleting recipe', 'error');
        }
    }

    function isRecipeSaved(dishName) {
        const savedRecipes = getSavedRecipes();
        return savedRecipes.some(r => r.dishName === dishName);
    }

    function updateSavedRecipesUI() {
        const savedRecipes = getSavedRecipes();
        const savedCount = document.getElementById('savedCount');
        const savedRecipesList = document.getElementById('savedRecipesList');
        
        if (savedRecipes.length > 0) {
            savedCount.textContent = savedRecipes.length;
            savedCount.classList.remove('hidden');
        } else {
            savedCount.classList.add('hidden');
        }
        
        if (savedRecipes.length === 0) {
            savedRecipesList.innerHTML = '<p class="text-center text-gray-500 py-8">No saved recipes yet! Start exploring and save your favorites.</p>';
        } else {
            savedRecipesList.innerHTML = savedRecipes.map(recipe => `
                <div class="saved-recipe-card" data-dish="${recipe.dishName}">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-800 mb-1">${recipe.dishName}</h4>
                            <p class="text-xs text-gray-500">Saved on ${new Date(recipe.savedAt).toLocaleDateString()}</p>
                        </div>
                        <button class="delete-recipe-btn ml-2 text-red-500 hover:text-red-700 transition-colors" data-dish="${recipe.dishName}" aria-label="Delete recipe">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `).join('');
            
            document.querySelectorAll('.saved-recipe-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (!e.target.closest('.delete-recipe-btn')) {
                        const dishName = card.dataset.dish;
                        const recipe = savedRecipes.find(r => r.dishName === dishName);
                        if (recipe) {
                            displaySavedRecipe(recipe);
                            document.getElementById('savedRecipesDropdown').classList.remove('show');
                        }
                    }
                });
            });
            
            document.querySelectorAll('.delete-recipe-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const dishName = btn.dataset.dish;
                    if (confirm(`Delete "${dishName}" from saved recipes?`)) {
                        deleteRecipe(dishName);
                    }
                });
            });
        }
    }

    function displaySavedRecipe(recipe) {
        currentRecipe = recipe;
        
        document.getElementById('heroSection').classList.add('hidden');
        document.getElementById('filterSection').classList.add('hidden');
        document.getElementById('loadingContainer').classList.add('hidden');
        document.getElementById('errorContainer').classList.add('hidden');
        
        document.getElementById('recipeDishName').textContent = recipe.dishName;
        document.getElementById('recipeText').innerHTML = recipe.recipeText;
        
        // Display metadata if available
        if (recipe.difficulty && recipe.prepTime && recipe.cookTime) {
            updateRecipeMetadata(recipe.difficulty, recipe.prepTime, recipe.cookTime, recipe.servings || '4');
        } else {
            // Analyze if not stored
            const difficulty = analyzeDifficulty(recipe.recipeText);
            const times = extractTimes(recipe.recipeText);
            const servings = extractServings(recipe.recipeText);
            updateRecipeMetadata(difficulty, times.prepTime, times.cookTime, servings);
        }
        
        updateSaveButton();
        addTimerButtons();
        
        document.getElementById('recipeContainer').classList.remove('hidden');
        document.getElementById('backToHome').classList.remove('hidden');
    }

    function updateSaveButton() {
        const saveBtn = document.getElementById('saveRecipeBtn');
        const saveIcon = document.getElementById('saveIcon');
        const saveText = document.getElementById('saveText');
        
        if (currentRecipe && isRecipeSaved(currentRecipe.dishName)) {
            saveBtn.classList.remove('from-green-500', 'to-emerald-600');
            saveBtn.classList.add('from-gray-400', 'to-gray-500', 'cursor-not-allowed');
            saveIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>';
            saveText.textContent = 'Saved';
            saveBtn.disabled = true;
        } else {
            saveBtn.classList.remove('from-gray-400', 'to-gray-500', 'cursor-not-allowed');
            saveBtn.classList.add('from-green-500', 'to-emerald-600');
            saveIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>';
            saveText.textContent = 'Save';
            saveBtn.disabled = false;
        }
    }

    // Event listeners for saved recipes
    document.getElementById('savedRecipesBtn').addEventListener('click', (e) => {
        e.stopPropagation();
        document.getElementById('savedRecipesDropdown').classList.toggle('show');
    });

    document.addEventListener('click', (e) => {
        const dropdown = document.getElementById('savedRecipesDropdown');
        const btn = document.getElementById('savedRecipesBtn');
        if (!dropdown.contains(e.target) && !btn.contains(e.target)) {
            dropdown.classList.remove('show');
        }
    });

    document.getElementById('saveRecipeBtn').addEventListener('click', () => {
        if (currentRecipe && saveRecipe(currentRecipe)) {
            const btn = document.getElementById('saveRecipeBtn');
            btn.classList.add('save-success');
            setTimeout(() => btn.classList.remove('save-success'), 300);
            updateSaveButton();
            showNotification('✓ Recipe saved successfully!', 'success');
        }
    });

    updateSavedRecipesUI();

    // ============================================
    // COOKING TIMER SYSTEM
    // ============================================
    
    function parseTimeToSeconds(timeStr) {
        const hourMatch = timeStr.match(/(\d+)\s*(?:hour|hr|h)/i);
        const minuteMatch = timeStr.match(/(\d+)\s*(?:minute|min|m)/i);
        const secondMatch = timeStr.match(/(\d+)\s*(?:second|sec|s)/i);
        
        let seconds = 0;
        if (hourMatch) seconds += parseInt(hourMatch[1]) * 3600;
        if (minuteMatch) seconds += parseInt(minuteMatch[1]) * 60;
        if (secondMatch) seconds += parseInt(secondMatch[1]);
        
        return seconds;
    }

    function formatTime(seconds) {
        const hrs = Math.floor(seconds / 3600);
        const mins = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;
        
        if (hrs > 0) {
            return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    function addTimerButtons() {
        const recipeText = document.getElementById('recipeText');
        if (!recipeText) return;
        
        const stepItems = recipeText.querySelectorAll('.step-item');
        
        stepItems.forEach((step, index) => {
            const text = step.textContent;
            const timeMatch = text.match(/(\d+(?:-\d+)?)\s*(?:minutes?|mins?|hours?|hrs?|seconds?|secs?)/i);
            
            if (timeMatch) {
                const timeStr = timeMatch[0];
                const seconds = parseTimeToSeconds(timeStr);
                
                if (seconds > 0) {
                    const timerBtn = document.createElement('button');
                    timerBtn.className = 'timer-btn';
                    timerBtn.setAttribute('aria-label', `Start timer for ${timeStr}`);
                    timerBtn.innerHTML = `
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                        </svg>
                        ${timeStr}
                    `;
                    
                    timerBtn.onclick = () => startTimer(seconds, `Step ${index + 1}`, timeStr);
                    step.appendChild(timerBtn);
                }
            }
        });
    }

    function startTimer(seconds, stepName, timeStr) {
        const timerId = timerIdCounter++;
        
        const timer = {
            id: timerId,
            name: stepName,
            totalSeconds: seconds,
            remainingSeconds: seconds,
            isPaused: false,
            isCompleted: false,
            interval: null
        };
        
        activeTimers.push(timer);
        
        timer.interval = setInterval(() => {
            if (!timer.isPaused && timer.remainingSeconds > 0) {
                timer.remainingSeconds--;
                updateTimerDisplay();
                
                if (timer.remainingSeconds === 0) {
                    completeTimer(timer);
                }
            }
        }, 1000);
        
        showTimerWidget();
        updateTimerDisplay();
    }

    function pauseTimer(timerId) {
        const timer = activeTimers.find(t => t.id === timerId);
        if (timer) {
            timer.isPaused = true;
            updateTimerDisplay();
        }
    }

    function resumeTimer(timerId) {
        const timer = activeTimers.find(t => t.id === timerId);
        if (timer) {
            timer.isPaused = false;
            updateTimerDisplay();
        }
    }

    function stopTimer(timerId) {
        const timer = activeTimers.find(t => t.id === timerId);
        if (timer) {
            clearInterval(timer.interval);
            activeTimers = activeTimers.filter(t => t.id !== timerId);
            updateTimerDisplay();
            
            if (activeTimers.length === 0) {
                hideTimerWidget();
            }
        }
    }

    function completeTimer(timer) {
        timer.isCompleted = true;
        clearInterval(timer.interval);
        
        // Play sound notification
        const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZUQ8MUKXi8LxoIQc1j9Xy0H8uBSh+zPLaizsIGGS56eibUxELTKXi8MJYHAY5lNXy0oY1Bjpt');
        audio.play().catch(() => {}); // Ignore if autoplay blocked
        
        showTimerNotification(timer.name);
        updateTimerDisplay();
    }

    function showTimerNotification(stepName) {
        const notification = document.getElementById('timerNotification');
        const notificationText = document.getElementById('timerNotificationText');
        
        notificationText.textContent = stepName;
        notification.classList.remove('hidden');
    }

    document.getElementById('dismissTimerNotification').addEventListener('click', () => {
        document.getElementById('timerNotification').classList.add('hidden');
    });

    function showTimerWidget() {
        const widget = document.getElementById('timerWidget');
        const minimized = document.getElementById('timerMinimized');
        const expanded = document.getElementById('timerExpanded');
        
        widget.classList.remove('hidden');
        minimized.classList.remove('hidden');
        expanded.classList.add('hidden');
    }

    function hideTimerWidget() {
        document.getElementById('timerWidget').classList.add('hidden');
    }

    function updateTimerDisplay() {
        const timersList = document.getElementById('timersList');
        const activeCount = document.getElementById('activeTimerCount');
        
        activeCount.textContent = activeTimers.length;
        
        if (activeTimers.length === 0) {
            timersList.innerHTML = '<p class="text-center text-gray-500 py-4">No active timers</p>';
            return;
        }
        
        timersList.innerHTML = activeTimers.map(timer => `
            <div class="timer-card ${timer.isCompleted ? 'completed' : ''}">
                <h4 class="font-bold text-gray-800 mb-2">${timer.name}</h4>
                <div class="timer-display">${formatTime(timer.remainingSeconds)}</div>
                ${timer.isCompleted ? 
                    '<p class="text-center text-green-600 font-bold mb-2">✓ Complete!</p>' :
                    `<div class="timer-controls">
                        ${timer.isPaused ?
                            `<button class="timer-control-btn resume" onclick="resumeTimer(${timer.id})" aria-label="Resume timer">▶ Resume</button>` :
                            `<button class="timer-control-btn pause" onclick="pauseTimer(${timer.id})" aria-label="Pause timer">⏸ Pause</button>`
                        }
                        <button class="timer-control-btn stop" onclick="stopTimer(${timer.id})" aria-label="Stop timer">⏹ Stop</button>
                    </div>`
                }
            </div>
        `).join('');
    }

    document.getElementById('timerMinimized').addEventListener('click', () => {
        document.getElementById('timerMinimized').classList.add('hidden');
        document.getElementById('timerExpanded').classList.remove('hidden');
    });

    document.getElementById('closeTimerWidget').addEventListener('click', () => {
        document.getElementById('timerExpanded').classList.add('hidden');
        document.getElementById('timerMinimized').classList.remove('hidden');
    });

    // Cleanup timers on page unload
    window.addEventListener('beforeunload', () => {
        activeTimers.forEach(timer => {
            if (timer.interval) clearInterval(timer.interval);
        });
    });

    // ============================================
    // SHOPPING LIST SYSTEM (with error handling)
    // ============================================
    
    function getShoppingList() {
        try {
            const list = localStorage.getItem('shoppingList');
            if (!list) return [];
            
            const parsed = JSON.parse(list);
            return Array.isArray(parsed) ? parsed : [];
        } catch (error) {
            console.error('Failed to load shopping list:', error);
            localStorage.removeItem('shoppingList');
            return [];
        }
    }

    function saveShoppingList(items) {
        try {
            localStorage.setItem('shoppingList', JSON.stringify(items));
            updateShoppingListUI();
        } catch (error) {
            console.error('Failed to save shopping list:', error);
            showNotification('Error saving shopping list', 'error');
        }
    }

    function extractIngredients() {
        const ingredientItems = document.querySelectorAll('.ingredient-item');
        const ingredients = [];
        
        ingredientItems.forEach(item => {
            const text = item.textContent.trim().replace('•', '').trim();
            if (text) {
                ingredients.push(text);
            }
        });
        
        return ingredients;
    }

    function addToShoppingList() {
        if (!currentRecipe) return;
        
        const btn = document.getElementById('addToListBtn');
        btn.disabled = true;
        btn.innerHTML = '<span class="animate-pulse">⏳</span> Adding...';
        
        try {
            const ingredients = extractIngredients();
            const shoppingList = getShoppingList();
            
            let addedCount = 0;
            ingredients.forEach(ingredient => {
                const exists = shoppingList.find(item => 
                    item.ingredient === ingredient && item.recipe === currentRecipe.dishName
                );
                
                if (!exists) {
                    shoppingList.push({
                        id: Date.now() + Math.random(),
                        ingredient: ingredient,
                        recipe: currentRecipe.dishName,
                        checked: false,
                        addedAt: new Date().toISOString()
                    });
                    addedCount++;
                }
            });
            
            saveShoppingList(shoppingList);
            
            // Update button state
            btn.classList.remove('from-blue-500', 'to-indigo-600');
            btn.classList.add('from-gray-400', 'to-gray-500');
            const icon = document.getElementById('listIcon');
            const text = document.getElementById('listText');
            icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>';
            text.textContent = 'Added';
            
            showNotification(`✓ Added ${addedCount} items to shopping list!`, 'success');
        } catch (error) {
            console.error('Failed to add to shopping list:', error);
            showNotification('Error adding to shopping list', 'error');
        } finally {
            btn.disabled = false;
        }
    }

    function toggleShoppingItem(itemId) {
        const shoppingList = getShoppingList();
        const item = shoppingList.find(i => i.id === itemId);
        if (item) {
            item.checked = !item.checked;
            saveShoppingList(shoppingList);
        }
    }

    function deleteShoppingItem(itemId) {
        let shoppingList = getShoppingList();
        shoppingList = shoppingList.filter(i => i.id !== itemId);
        saveShoppingList(shoppingList);
    }

    function clearCompletedItems() {
        let shoppingList = getShoppingList();
        const completedCount = shoppingList.filter(i => i.checked).length;
        shoppingList = shoppingList.filter(i => !i.checked);
        saveShoppingList(shoppingList);
        showNotification(`✓ Cleared ${completedCount} completed items`, 'success');
    }

    function clearAllItems() {
        if (confirm('Clear entire shopping list?')) {
            saveShoppingList([]);
            showNotification('✓ Shopping list cleared', 'success');
        }
    }

    function printShoppingList() {
        const shoppingList = getShoppingList();
        
        if (shoppingList.length === 0) {
            showNotification('Shopping list is empty', 'warning');
            return;
        }
        
        const printWindow = window.open('', '', 'width=800,height=600');
        printWindow.document.write(`
            <html>
            <head>
                <title>Shopping List - Namak Shamak</title>
                <style>
                    body { font-family: Arial, sans-serif; padding: 20px; }
                    h1 { color: #ea580c; border-bottom: 3px solid #fed7aa; padding-bottom: 10px; }
                    .recipe-group { margin-bottom: 30px; }
                    .recipe-name { font-size: 1.2em; font-weight: bold; color: #1f2937; margin-bottom: 10px; }
                    .ingredient { padding: 8px; margin: 5px 0; border-left: 4px solid #fb923c; background: #fff7ed; }
                    input[type="checkbox"] { margin-right: 10px; }
                </style>
            </head>
            <body>
                <h1>🛒 Shopping List</h1>
                <p>Generated from Namak Shamak - ${new Date().toLocaleDateString()}</p>
                ${Object.entries(
                    shoppingList.reduce((acc, item) => {
                        if (!acc[item.recipe]) acc[item.recipe] = [];
                        acc[item.recipe].push(item);
                        return acc;
                    }, {})
                ).map(([recipe, items]) => `
                    <div class="recipe-group">
                        <div class="recipe-name">${recipe}</div>
                        ${items.map(item => `
                            <div class="ingredient">
                                <input type="checkbox" ${item.checked ? 'checked' : ''}>
                                ${item.ingredient}
                            </div>
                        `).join('')}
                    </div>
                `).join('')}
            </body>
            </html>
        `);
        printWindow.document.close();
        printWindow.print();
    }

    function copyShoppingList() {
        const shoppingList = getShoppingList();
        
        if (shoppingList.length === 0) {
            showNotification('Shopping list is empty', 'warning');
            return;
        }
        
        const text = Object.entries(
            shoppingList.reduce((acc, item) => {
                if (!acc[item.recipe]) acc[item.recipe] = [];
                acc[item.recipe].push(item);
                return acc;
            }, {})
        ).map(([recipe, items]) => 
            `${recipe}:\n${items.map(item => `- ${item.ingredient}`).join('\n')}`
        ).join('\n\n');
        
        navigator.clipboard.writeText(text).then(() => {
            showNotification('✓ Copied to clipboard!', 'success');
        }).catch(() => {
            showNotification('Failed to copy', 'error');
        });
    }

    function updateShoppingListUI() {
        const shoppingList = getShoppingList();
        const shoppingCount = document.getElementById('shoppingCount');
        const shoppingItemsList = document.getElementById('shoppingItemsList');
        const actionsContainer = document.getElementById('shoppingActionsContainer');
        
        if (shoppingList.length > 0) {
            shoppingCount.textContent = shoppingList.length;
            shoppingCount.classList.remove('hidden');
        } else {
            shoppingCount.classList.add('hidden');
        }
        
        if (shoppingList.length === 0) {
            shoppingItemsList.innerHTML = '<p class="text-center text-gray-500 py-8">No items in your shopping list yet!</p>';
            actionsContainer.classList.add('hidden');
        } else {
            actionsContainer.classList.remove('hidden');
            shoppingItemsList.innerHTML = shoppingList.map(item => `
                <div class="shopping-item ${item.checked ? 'checked' : ''}">
                    <input type="checkbox" class="shopping-checkbox" ${item.checked ? 'checked' : ''} 
                        onchange="toggleShoppingItem(${item.id})" aria-label="Mark ${item.ingredient} as done">
                    <div class="shopping-item-text">
                        <div class="shopping-item-ingredient">${item.ingredient}</div>
                        <span class="shopping-item-recipe">${item.recipe}</span>
                    </div>
                    <button class="shopping-delete-btn" onclick="deleteShoppingItem(${item.id})" aria-label="Delete ${item.ingredient}">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>
            `).join('');
        }
    }

    // Event listeners for shopping list
    document.getElementById('shoppingListBtn').addEventListener('click', (e) => {
        e.stopPropagation();
        document.getElementById('shoppingListDropdown').classList.toggle('show');
    });

    document.addEventListener('click', (e) => {
        const dropdown = document.getElementById('shoppingListDropdown');
        const btn = document.getElementById('shoppingListBtn');
        if (!dropdown.contains(e.target) && !btn.contains(e.target)) {
            dropdown.classList.remove('show');
        }
    });

    document.getElementById('addToListBtn').addEventListener('click', addToShoppingList);
    document.getElementById('clearCompletedBtn').addEventListener('click', clearCompletedItems);
    document.getElementById('clearAllBtn').addEventListener('click', clearAllItems);
    document.getElementById('printListBtn').addEventListener('click', printShoppingList);
    document.getElementById('copyListBtn').addEventListener('click', copyShoppingList);

    updateShoppingListUI();

    // ============================================
    // DIFFICULTY & METADATA ANALYSIS
    // ============================================
    
    function analyzeDifficulty(recipeText) {
        const ingredientMatches = recipeText.match(/ingredient-item/g);
        const ingredientCount = ingredientMatches ? ingredientMatches.length : 0;
        
        const stepMatches = recipeText.match(/step-item/g);
        const stepCount = stepMatches ? stepMatches.length : 0;
        
        const complexTechniques = [
            'sous vide', 'reduction', 'tempering', 'julienne', 
            'brunoise', 'emulsify', 'caramelize', 'deglaze', 
            'marinate overnight', 'ferment', 'proof', 'blanch',
            'sear', 'braise', 'confit', 'clarify'
        ];
        const hasComplexTechnique = complexTechniques.some(tech => 
            recipeText.toLowerCase().includes(tech)
        );
        
        if (ingredientCount <= 10 && stepCount <= 5 && !hasComplexTechnique) {
            return 'Easy';
        } else if (ingredientCount <= 20 && stepCount <= 10) {
            return 'Medium';
        } else {
            return 'Hard';
        }
    }

    function extractTimes(recipeText) {
    // Look for various time formats
    const prepPatterns = [
        /prep(?:aration)?\s*time:?\s*(\d+)\s*(?:min|minute|minutes|mins|hr|hour|hours)/i,
        /prep:?\s*(\d+)\s*(?:min|minute|minutes|mins)/i,
        /preparation:?\s*(\d+)\s*(?:min|minute|minutes|mins)/i
    ];
    
    const cookPatterns = [
        /cook(?:ing)?\s*time:?\s*(\d+)\s*(?:min|minute|minutes|mins|hr|hour|hours)/i,
        /cook:?\s*(\d+)\s*(?:min|minute|minutes|mins)/i,
        /cooking:?\s*(\d+)\s*(?:min|minute|minutes|mins)/i
    ];
    
    let prepTime = null;
    let cookTime = null;
    
    // Try to find prep time
    for (const pattern of prepPatterns) {
        const match = recipeText.match(pattern);
        if (match) {
            prepTime = `${match[1]} mins`;
            break;
        }
    }
    
    // Try to find cook time
    for (const pattern of cookPatterns) {
        const match = recipeText.match(pattern);
        if (match) {
            cookTime = `${match[1]} mins`;
            break;
        }
    }
    
    // Smart defaults based on recipe complexity if not found
    if (!prepTime) {
        const ingredientCount = (recipeText.match(/ingredient-item/g) || []).length;
        prepTime = ingredientCount > 15 ? '25 mins' : ingredientCount > 8 ? '15 mins' : '10 mins';
    }
    
    if (!cookTime) {
        const stepCount = (recipeText.match(/step-item/g) || []).length;
        cookTime = stepCount > 10 ? '45 mins' : stepCount > 6 ? '30 mins' : '20 mins';
    }
    
    return { prepTime, cookTime };
}

    function extractServings(recipeText) {
        const servingMatch = recipeText.match(/serves?\s*:?\s*(\d+)/i);
        return servingMatch ? servingMatch[1] : '4';
    }

    function displayDifficultyBadge(difficulty) {
        const badge = document.getElementById('difficultyBadge');
        const icons = {
            'Easy': '🟢',
            'Medium': '🟡',
            'Hard': '🔴'
        };
        
        badge.className = `difficulty-badge difficulty-${difficulty.toLowerCase()}`;
        badge.innerHTML = `${icons[difficulty]} ${difficulty}`;
        badge.classList.remove('hidden');
    }

    function updateRecipeMetadata(difficulty, prepTime, cookTime, servings) {
        displayDifficultyBadge(difficulty);
        document.getElementById('prepTime').textContent = prepTime;
        document.getElementById('cookTime').textContent = cookTime;
        document.getElementById('servings').textContent = servings;
    }

    // ============================================
    // DISH DATABASE
    // ============================================
    
    const dishDatabase = {
        "Indian": {
            "Most Popular": ["Butter Chicken", "Biryani", "Paneer Tikka Masala", "Samosa", "Dosa"],
            "Most Spicy": ["Vindaloo", "Andhra Chicken Curry", "Laal Maas", "Bhut Jolokia Chicken"],
            "Sweet": ["Gulab Jamun", "Rasgulla", "Jalebi", "Kheer", "Barfi"],
            "Healthy": ["Dal Tadka", "Palak Paneer", "Quinoa Upma", "Moong Dal Chilla"],
            "Quick & Easy": ["Poha", "Upma", "Masala Omelette", "Vegetable Pulao"],
            "Vegetarian": ["Paneer Butter Masala", "Chole Bhature", "Aloo Gobi", "Dal Makhani"],
            "Desserts": ["Gulab Jamun", "Rasgulla", "Kheer", "Gajar Halwa", "Ras Malai"]
        },
        "Italian": {
            "Most Popular": ["Margherita Pizza", "Spaghetti Carbonara", "Lasagna", "Risotto", "Tiramisu"],
            "Most Spicy": ["Arrabbiata Pasta", "Calabrian Pizza", "Spicy Italian Sausage Pasta"],
            "Sweet": ["Tiramisu", "Panna Cotta", "Cannoli", "Gelato", "Affogato"],
            "Healthy": ["Caprese Salad", "Minestrone Soup", "Grilled Fish with Herbs"],
            "Quick & Easy": ["Aglio e Olio", "Caprese Salad", "Bruschetta", "Margherita Pizza"],
            "Vegetarian": ["Margherita Pizza", "Pesto Pasta", "Eggplant Parmesan", "Caprese Salad"],
            "Desserts": ["Tiramisu", "Panna Cotta", "Cannoli", "Gelato", "Biscotti"]
        },
        "Chinese": {
            "Most Popular": ["Fried Rice", "Chow Mein", "Kung Pao Chicken", "Sweet and Sour Pork", "Dumplings"],
            "Most Spicy": ["Mapo Tofu", "Szechuan Chicken", "Chongqing Chicken", "Spicy Wontons"],
            "Sweet": ["Sweet and Sour Pork", "Orange Chicken", "Honey Sesame Chicken"],
            "Healthy": ["Steamed Fish", "Buddha Bowl", "Vegetable Stir Fry", "Hot and Sour Soup"],
            "Quick & Easy": ["Fried Rice", "Egg Drop Soup", "Spring Rolls", "Stir Fried Vegetables"],
            "Vegetarian": ["Vegetable Fried Rice", "Mapo Tofu", "Vegetable Dumplings", "Pak Choi Stir Fry"],
            "Desserts": ["Mango Pudding", "Sesame Balls", "Egg Tarts", "Almond Cookies"]
        },
        "Mexican": {
            "Most Popular": ["Tacos", "Burrito", "Quesadilla", "Nachos", "Enchiladas"],
            "Most Spicy": ["Chipotle Chicken", "Jalapeño Poppers", "Spicy Salsa", "Habanero Tacos"],
            "Sweet": ["Churros", "Tres Leches Cake", "Flan", "Mexican Hot Chocolate"],
            "Healthy": ["Chicken Taco Bowl", "Black Bean Salad", "Grilled Fish Tacos"],
            "Quick & Easy": ["Quesadilla", "Nachos", "Simple Tacos", "Mexican Rice"],
            "Vegetarian": ["Bean Burrito", "Veggie Quesadilla", "Guacamole", "Black Bean Tacos"],
            "Desserts": ["Churros", "Tres Leches Cake", "Flan", "Sopapillas"]
        },
        "Japanese": {
            "Most Popular": ["Sushi", "Ramen", "Tempura", "Teriyaki Chicken", "Miso Soup"],
            "Most Spicy": ["Spicy Ramen", "Spicy Tuna Roll", "Karaage with Spicy Mayo"],
            "Sweet": ["Mochi", "Dorayaki", "Taiyaki", "Matcha Ice Cream"],
            "Healthy": ["Sashimi", "Miso Soup", "Edamame", "Seaweed Salad"],
            "Quick & Easy": ["Onigiri", "Miso Soup", "Edamame", "Simple Ramen"],
            "Vegetarian": ["Vegetable Sushi", "Agedashi Tofu", "Vegetable Tempura", "Miso Soup"],
            "Desserts": ["Mochi", "Dorayaki", "Matcha Ice Cream", "Taiyaki"]
        },
        "Thai": {
            "Most Popular": ["Pad Thai", "Green Curry", "Tom Yum Soup", "Massaman Curry", "Spring Rolls"],
            "Most Spicy": ["Green Curry", "Red Curry", "Som Tam", "Larb"],
            "Sweet": ["Mango Sticky Rice", "Thai Tea", "Coconut Ice Cream"],
            "Healthy": ["Tom Yum Soup", "Papaya Salad", "Steamed Fish with Lime"],
            "Quick & Easy": ["Pad Thai", "Spring Rolls", "Thai Fried Rice"],
            "Vegetarian": ["Vegetable Green Curry", "Pad Thai (Veg)", "Spring Rolls", "Papaya Salad"],
            "Desserts": ["Mango Sticky Rice", "Coconut Ice Cream", "Thai Banana Pancakes"]
        },
        "Mediterranean": {
            "Most Popular": ["Hummus", "Falafel", "Greek Salad", "Shawarma", "Tabbouleh"],
            "Most Spicy": ["Harissa Chicken", "Spicy Merguez Sausage", "Shakshuka"],
            "Sweet": ["Baklava", "Turkish Delight", "Loukoumades", "Halva"],
            "Healthy": ["Greek Salad", "Grilled Fish", "Lentil Soup", "Tabbouleh"],
            "Quick & Easy": ["Hummus", "Pita Bread", "Greek Salad", "Tzatziki"],
            "Vegetarian": ["Falafel", "Hummus", "Greek Salad", "Stuffed Grape Leaves"],
            "Desserts": ["Baklava", "Turkish Delight", "Loukoumades", "Kunafa"]
        },
        "American": {
            "Most Popular": ["Burger", "Mac and Cheese", "BBQ Ribs", "Fried Chicken", "Hot Dog"],
            "Most Spicy": ["Buffalo Wings", "Spicy Fried Chicken", "Jalapeño Burger"],
            "Sweet": ["Apple Pie", "Brownies", "Cheesecake", "Chocolate Chip Cookies"],
            "Healthy": ["Grilled Chicken Salad", "Quinoa Bowl", "Turkey Burger"],
            "Quick & Easy": ["Grilled Cheese", "Hot Dog", "Simple Burger", "Mac and Cheese"],
            "Vegetarian": ["Veggie Burger", "Mac and Cheese", "Garden Salad", "Grilled Cheese"],
            "Desserts": ["Apple Pie", "Brownies", "Cheesecake", "Chocolate Chip Cookies", "Donuts"]
        }
    };

    // ============================================
    // RECIPE FORMATTING
    // ============================================
    
    function formatRecipe(text) {
    let formatted = text;
    let stepCounter = 1;
    
    // Handle markdown tables
    formatted = formatted.replace(/^\|[\s\S]*?\|$/gm, (match) => {
        if (match.includes('---')) return '';
        
        const cells = match.split('|').map(cell => cell.trim()).filter(cell => cell);
        
        if (cells.some(cell => cell.toLowerCase().includes('ingredient') || 
                               cell.toLowerCase().includes('quantity') || 
                               cell.toLowerCase().includes('hinglish'))) {
            return '';
        }
        
        if (cells.length >= 1 && cells[0]) {
            const ingredient = cells.join(' - ');
            return `<div class="ingredient-item">• ${ingredient}</div>\n`;
        }
        return '';
    });
    
    // Handle headings - ADD SPACES
    formatted = formatted.replace(/#{1,3}\s*(.+)/g, (match, title) => {
        if (title.toLowerCase().includes('ingredient')) {
            return `\n<div class="recipe-heading">🥘 ${title}</div>\n`;
        } else if (title.toLowerCase().includes('instruction') || title.toLowerCase().includes('step')) {
            stepCounter = 1;
            return `\n<div class="recipe-heading">👨‍🍳 ${title}</div>\n`;
        } else {
            return `\n<div class="recipe-subheading">${title}</div>\n`;
        }
    });
    
    // Handle bullet points - PRESERVE CONTENT
    formatted = formatted.replace(/^\*\s+(.+)$/gm, (match, item) => {
        return `<div class="ingredient-item">• ${item}</div>\n`;
    });
    
    // Handle numbered lists - PRESERVE CONTENT
    formatted = formatted.replace(/^\d+\.\s+(.+)$/gm, (match, item) => {
        return `<div class="step-item"><div class="step-number">${stepCounter++}</div>${item}</div>\n`;
    });
    
    // Handle bold text
    formatted = formatted.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    
    // Clean up table artifacts
    formatted = formatted.replace(/\|/g, '');
    formatted = formatted.replace(/^-{3,}$/gm, '');
    
    // Split into lines and process
    const lines = formatted.split('\n');
    const processed = [];
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();
        
        // Skip empty lines
        if (!line) continue;
        
        // If line already has HTML tags, keep it
        if (line.includes('<div')) {
            processed.push(line);
        }
        // Otherwise wrap in paragraph
        else if (line.length > 0) {
            processed.push(`<p>${line}</p>`);
        }
    }
    
    return processed.join('\n');
}

// ============================================
// NUTRITIONAL INFORMATION SYSTEM
// ============================================

function detectDietaryTags(recipeText, ingredients) {
    const tags = [];
    const text = (recipeText + ' ' + ingredients.join(' ')).toLowerCase();
    
    // Vegan detection (no animal products)
    const nonVeganKeywords = ['chicken', 'meat', 'fish', 'egg', 'dairy', 'milk', 'cheese', 'butter', 'ghee', 'yogurt', 'cream', 'paneer', 'honey'];
    const hasNonVegan = nonVeganKeywords.some(kw => text.includes(kw));
    
    if (!hasNonVegan && (text.includes('vegetable') || text.includes('tofu') || text.includes('lentil'))) {
        tags.push({ type: 'vegan', label: '🌱 Vegan' });
    }
    
    // Vegetarian detection
    const meatKeywords = ['chicken', 'meat', 'fish', 'pork', 'beef', 'mutton', 'lamb', 'seafood', 'prawn', 'shrimp'];
    const hasMeat = meatKeywords.some(kw => text.includes(kw));
    
    if (!hasMeat && !tags.find(t => t.type === 'vegan')) {
        tags.push({ type: 'vegetarian', label: '🥛 Vegetarian' });
    }
    
    // Gluten-free detection
    const glutenKeywords = ['wheat', 'flour', 'bread', 'pasta', 'noodle', 'roti', 'chapati', 'naan'];
    const hasGluten = glutenKeywords.some(kw => text.includes(kw));
    
    if (!hasGluten) {
        tags.push({ type: 'gluten-free', label: '🌾 Gluten-Free' });
    }
    
    // Keto detection (high fat, low carb)
    const highCarbKeywords = ['rice', 'potato', 'bread', 'pasta', 'sugar', 'honey'];
    const highFatKeywords = ['butter', 'ghee', 'oil', 'cream', 'cheese', 'avocado', 'nuts'];
    
    const hasLowCarb = !highCarbKeywords.some(kw => text.includes(kw));
    const hasHighFat = highFatKeywords.some(kw => text.includes(kw));
    
    if (hasLowCarb && hasHighFat) {
        tags.push({ type: 'keto', label: '🥩 Keto' });
    }
    
    // Low-sugar detection
    const sugarKeywords = ['sugar', 'honey', 'jaggery', 'syrup', 'sweet'];
    const hasSugar = sugarKeywords.some(kw => text.includes(kw));
    
    if (!hasSugar) {
        tags.push({ type: 'low-sugar', label: '🍬 Low-Sugar' });
    }
    
    return tags;
}

function detectAllergens(recipeText, ingredients) {
    const allergens = [];
    const text = (recipeText + ' ' + ingredients.join(' ')).toLowerCase();
    
    if (text.includes('dairy') || text.includes('milk') || text.includes('cheese') || text.includes('butter') || text.includes('cream') || text.includes('yogurt') || text.includes('paneer') || text.includes('ghee')) {
        allergens.push('Dairy');
    }
    
    if (text.includes('nut') || text.includes('almond') || text.includes('cashew') || text.includes('peanut') || text.includes('walnut')) {
        allergens.push('Nuts');
    }
    
    if (text.includes('egg')) {
        allergens.push('Eggs');
    }
    
    if (text.includes('wheat') || text.includes('flour') || text.includes('gluten')) {
        allergens.push('Gluten');
    }
    
    if (text.includes('shellfish') || text.includes('prawn') || text.includes('shrimp') || text.includes('crab') || text.includes('lobster')) {
        allergens.push('Shellfish');
    }
    
    if (text.includes('soy') || text.includes('tofu')) {
        allergens.push('Soy');
    }
    
    if (text.includes('fish') || text.includes('salmon') || text.includes('tuna')) {
        allergens.push('Fish');
    }
    
    return allergens;
}

function calculateHealthScore(recipeText, dietaryTags, allergenCount) {
    let score = 5; // Base score
    
    const text = recipeText.toLowerCase();
    
    // Positive factors
    if (text.includes('vegetable') || text.includes('salad')) score += 1;
    if (text.includes('grill') || text.includes('bake') || text.includes('steam')) score += 1;
    if (dietaryTags.find(t => t.type === 'vegan')) score += 1;
    if (text.includes('olive oil') || text.includes('healthy')) score += 0.5;
    
    // Negative factors
    if (text.includes('fried') || text.includes('deep fry')) score -= 1.5;
    if (text.includes('cream') || text.includes('butter') && !text.includes('peanut butter')) score -= 0.5;
    if (text.includes('sugar') || text.includes('sweet')) score -= 0.5;
    if (allergenCount > 2) score -= 0.5;
    
    // Clamp between 1-10
    score = Math.max(1, Math.min(10, Math.round(score)));
    
    return score;
}

function estimateNutrition(dishName, recipeText) {
    const text = recipeText.toLowerCase();
    
    // Base estimation by dish type
    let calories = 350;
    let protein = 25;
    let carbs = 40;
    let fat = 15;
    
    // Adjust based on ingredients/cooking method
    if (text.includes('fried') || text.includes('deep fry')) {
        calories += 150;
        fat += 15;
    }
    
    if (text.includes('rice') || text.includes('pasta') || text.includes('bread')) {
        carbs += 20;
        calories += 100;
    }
    
    if (text.includes('chicken') || text.includes('meat') || text.includes('fish')) {
        protein += 15;
        calories += 50;
    }
    
    if (text.includes('cream') || text.includes('butter') || text.includes('cheese')) {
        fat += 10;
        calories += 100;
    }
    
    if (text.includes('salad') || text.includes('vegetable') && !text.includes('fried')) {
        calories -= 100;
        carbs -= 10;
    }
    
    return { calories, protein, carbs, fat };
}

function displayNutritionInfo(dishName, recipeText) {
    const ingredients = Array.from(document.querySelectorAll('.ingredient-item'))
        .map(el => el.textContent.trim());
    
    // Get nutrition estimates
    const nutrition = estimateNutrition(dishName, recipeText);
    
    // Detect dietary tags
    const dietaryTags = detectDietaryTags(recipeText, ingredients);
    
    // Detect allergens
    const allergens = detectAllergens(recipeText, ingredients);
    
    // Calculate health score
    const healthScore = calculateHealthScore(recipeText, dietaryTags, allergens.length);
    
    // Display nutrition values
    document.getElementById('nutritionCalories').textContent = nutrition.calories;
    document.getElementById('nutritionProtein').textContent = `${nutrition.protein}g`;
    document.getElementById('nutritionCarbs').textContent = `${nutrition.carbs}g`;
    document.getElementById('nutritionFat').textContent = `${nutrition.fat}g`;
    
    // Display dietary tags
    const tagsContainer = document.getElementById('dietaryTagsContainer');
    if (dietaryTags.length > 0) {
        tagsContainer.innerHTML = dietaryTags.map(tag => 
            `<span class="dietary-tag ${tag.type}">${tag.label}</span>`
        ).join('');
        tagsContainer.classList.remove('hidden');
    } else {
        tagsContainer.classList.add('hidden');
    }
    
    // Display allergen warning
    const allergenWarning = document.getElementById('allergenWarning');
    if (allergens.length > 0) {
        document.getElementById('allergenList').textContent = `Contains: ${allergens.join(', ')}`;
        allergenWarning.classList.remove('hidden');
    } else {
        allergenWarning.classList.add('hidden');
    }
    
    // Display health score
    const stars = '⭐'.repeat(healthScore) + '☆'.repeat(10 - healthScore);
    document.getElementById('healthScoreStars').textContent = stars;
    document.getElementById('healthScoreValue').textContent = `(${healthScore}/10)`;
    
    // Show nutrition container
    document.getElementById('nutritionContainer').classList.remove('hidden');
}
// ============================================
// RECIPE VARIATIONS & SUBSTITUTIONS
// ============================================

const substitutionDatabase = {
    "butter": {
        vegan: ["coconut oil", "vegan butter", "olive oil"],
        healthy: ["olive oil", "avocado oil"],
        budget: ["vegetable oil", "margarine"],
        general: ["ghee", "coconut oil", "vegetable oil"]
    },
    "heavy cream": {
        vegan: ["coconut cream", "cashew cream", "oat cream"],
        healthy: ["greek yogurt", "low-fat milk"],
        budget: ["milk + butter", "evaporated milk"],
        general: ["half-and-half", "coconut cream", "cashew cream"]
    },
    "chicken": {
        vegan: ["tofu", "tempeh", "chickpeas", "mushrooms"],
        healthy: ["chicken breast", "turkey"],
        budget: ["chicken thighs", "eggs"],
        general: ["paneer", "tofu", "cauliflower"]
    },
    "milk": {
        vegan: ["almond milk", "soy milk", "oat milk", "coconut milk"],
        healthy: ["skim milk", "almond milk"],
        budget: ["powdered milk"],
        general: ["any plant-based milk", "water + cream"]
    },
    "cheese": {
        vegan: ["nutritional yeast", "vegan cheese", "cashew cheese"],
        healthy: ["cottage cheese", "reduced-fat cheese"],
        budget: ["processed cheese", "paneer"],
        general: ["paneer", "tofu", "nutritional yeast"]
    },
    "egg": {
        vegan: ["flax egg", "chia egg", "applesauce", "banana"],
        healthy: ["egg whites", "egg substitute"],
        budget: ["powdered eggs"],
        general: ["flax egg", "chia seed gel", "yogurt"]
    },
    "paneer": {
        vegan: ["tofu", "cashew cheese"],
        healthy: ["cottage cheese", "tofu"],
        budget: ["firm tofu"],
        general: ["tofu", "halloumi", "feta"]
    },
    "ghee": {
        vegan: ["coconut oil", "vegetable oil"],
        healthy: ["olive oil"],
        budget: ["vegetable oil", "butter"],
        general: ["butter", "coconut oil", "clarified butter"]
    },
    "yogurt": {
        vegan: ["coconut yogurt", "soy yogurt", "almond yogurt"],
        healthy: ["greek yogurt", "low-fat yogurt"],
        budget: ["buttermilk", "sour cream"],
        general: ["sour cream", "coconut yogurt", "buttermilk"]
    },
    "sugar": {
        vegan: ["coconut sugar", "maple syrup"],
        healthy: ["stevia", "monk fruit", "dates"],
        budget: ["jaggery", "brown sugar"],
        general: ["honey", "maple syrup", "jaggery"]
    }
};

const relatedRecipesDatabase = {
    "butter chicken": ["Chicken Tikka Masala", "Palak Paneer", "Dal Makhani", "Chicken Korma"],
    "biryani": ["Pulao", "Fried Rice", "Hyderabadi Biryani", "Vegetable Biryani"],
    "pizza": ["Pasta", "Calzone", "Garlic Bread", "Bruschetta"],
    "pasta": ["Pizza", "Lasagna", "Risotto", "Spaghetti Carbonara"],
    "fried rice": ["Biryani", "Chow Mein", "Noodles", "Pulao"],
    "curry": ["Dal", "Korma", "Vindaloo", "Tikka Masala"],
    "samosa": ["Pakora", "Spring Rolls", "Kachori", "Aloo Tikki"],
    "dosa": ["Idli", "Uttapam", "Vada", "Paniyaram"],
    "tacos": ["Burrito", "Quesadilla", "Nachos", "Enchiladas"],
    "burger": ["Hot Dog", "Sandwich", "Grilled Chicken", "Sliders"]
};

function detectIngredients(recipeText) {
    const detected = [];
    const text = recipeText.toLowerCase();
    
    for (const ingredient in substitutionDatabase) {
        if (text.includes(ingredient)) {
            detected.push(ingredient);
        }
    }
    
    return detected;
}

function generateSubstitutions(ingredients, variationType = 'general') {
    const substitutions = [];
    
    ingredients.forEach(ingredient => {
        const subs = substitutionDatabase[ingredient];
        if (subs) {
            const alternatives = subs[variationType] || subs.general;
            if (alternatives && alternatives.length > 0) {
                substitutions.push({
                    original: ingredient,
                    alternatives: alternatives.slice(0, 3) // Top 3 alternatives
                });
            }
        }
    });
    
    return substitutions;
}

function displaySubstitutions(ingredients) {
    const substitutions = generateSubstitutions(ingredients);
    const listContainer = document.getElementById('substitutionsList');
    
    if (substitutions.length === 0) {
        listContainer.innerHTML = '<p style="color: #6b7280; font-size: 0.875rem;">No common substitutions found for this recipe.</p>';
        return;
    }
    
    listContainer.innerHTML = substitutions.map(sub => `
        <div class="substitution-card">
            <div class="substitution-icon">🔄</div>
            <div class="substitution-content">
                <div class="substitution-original">${sub.original.charAt(0).toUpperCase() + sub.original.slice(1)}</div>
                <div class="substitution-alternatives">
                    <span class="substitution-arrow">→</span> ${sub.alternatives.join(', ')}
                </div>
            </div>
        </div>
    `).join('');
}

function findRelatedRecipes(dishName) {
    const name = dishName.toLowerCase();
    
    // Direct match
    if (relatedRecipesDatabase[name]) {
        return relatedRecipesDatabase[name];
    }
    
    // Partial match
    for (const key in relatedRecipesDatabase) {
        if (name.includes(key) || key.includes(name)) {
            return relatedRecipesDatabase[key];
        }
    }
    
    // Default suggestions
    return ["Butter Chicken", "Biryani", "Pizza", "Pasta"];
}

function displayRelatedRecipes(dishName) {
    const related = findRelatedRecipes(dishName);
    const container = document.getElementById('relatedRecipesList');
    
    const emojis = ['🍛', '🍝', '🍕', '🥘', '🍜', '🥗', '🍲', '🥙'];
    
    container.innerHTML = related.map((recipe, index) => `
        <div class="related-recipe-card" data-recipe="${recipe}">
            <div class="related-recipe-emoji">${emojis[index % emojis.length]}</div>
            <div class="related-recipe-name">${recipe}</div>
        </div>
    `).join('');
    
    // Add click handlers
    document.querySelectorAll('.related-recipe-card').forEach(card => {
        card.addEventListener('click', () => {
            const recipeName = card.dataset.recipe;
            generateRecipe(recipeName, false);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    });
}

function showVariations(dishName, recipeText) {
    const ingredients = detectIngredients(recipeText);
    
    if (ingredients.length > 0) {
        displaySubstitutions(ingredients);
        document.getElementById('variationsContainer').classList.remove('hidden');
    }
    
    displayRelatedRecipes(dishName);
    document.getElementById('relatedRecipesContainer').classList.remove('hidden');
}

// Variation button handlers
document.getElementById('makeVeganBtn').addEventListener('click', () => {
    if (!currentRecipe) return;
    
    showNotification('🌱 Generating vegan version...', 'info');
    generateRecipe(currentRecipe.dishName + ' (vegan version)', false);
});

document.getElementById('makeSpicyBtn').addEventListener('click', () => {
    if (!currentRecipe) return;
    
    showNotification('🌶️ Generating extra spicy version...', 'info');
    generateRecipe(currentRecipe.dishName + ' (extra spicy)', false);
});

document.getElementById('makeHealthyBtn').addEventListener('click', () => {
    if (!currentRecipe) return;
    
    showNotification('🥗 Generating healthier version...', 'info');
    generateRecipe(currentRecipe.dishName + ' (healthy version)', false);
});

document.getElementById('makeBudgetBtn').addEventListener('click', () => {
    if (!currentRecipe) return;
    
    showNotification('💰 Generating budget-friendly version...', 'info');
    generateRecipe(currentRecipe.dishName + ' (budget-friendly)', false);
});

    // ============================================
    // RECIPE GENERATION (with improved error handling)
    // ============================================
    
    async function generateRecipe(dishName, useHinglish = false) {

        // Validate and sanitize input
        const sanitized = sanitizeInput(dishName);
        if (!validateDishName(sanitized)) {
            return;
        }
         saveToSearchHistory(sanitized);
        document.getElementById('heroSection').classList.add('hidden');
        document.getElementById('filterSection').classList.add('hidden');
        document.getElementById('recipeContainer').classList.add('hidden');
        document.getElementById('errorContainer').classList.add('hidden');
        document.getElementById('loadingContainer').classList.remove('hidden');
        document.getElementById('backToHome').classList.remove('hidden');

        try {
            const systemPrompt = useHinglish
    ? "Aap ek friendly aur helpful chef hain. Aapko Hinglish (Hindi aur English ka mix) mein baat karni hai. Recipe ko easy-to-follow steps mein batayein. IMPORTANT: Recipe ke shuru mein yeh zaroor likhein:\n- Prep Time: [time] minutes\n- Cook Time: [time] minutes\n- Serves: [number] people\n\nFormat: Pehle prep/cook time aur servings, phir '## Ingredients' heading ke neeche ingredients ki list, phir '## Instructions' heading ke neeche step-by-step instructions numbered format mein."
    : "You are a friendly and helpful chef. Provide a clear and easy-to-follow recipe. IMPORTANT: At the very beginning, include:\n- Prep Time: [X] minutes\n- Cook Time: [X] minutes\n- Serves: [X] people\n\nFormat: Start with prep time, cook time, and servings info, then '## Ingredients' heading followed by ingredient list with bullet points (*), then '## Instructions' heading followed by numbered step-by-step instructions (1. 2. 3. etc).";

            const userQuery = `Please provide a detailed recipe for ${sanitized}.`;

            const payload = {
                model: "llama-3.1-8b-instant",
                messages: [
                    {
                        role: "system",
                        content: systemPrompt
                    },
                    {
                        role: "user",
                        content: userQuery
                    }
                ],
                temperature: 0.7,
                max_tokens: 2000
            };

            // Add timeout to fetch request
            const controller = new AbortController();
            const timeout = setTimeout(() => controller.abort(), REQUEST_TIMEOUT_MS);

            // 2. --- THIS ENTIRE FETCH BLOCK IS REPLACED ---
            // It now calls the Groq API directly, using your API_key and the 'payload' variable.
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_key}` // Use the key
                },
                body: JSON.stringify(payload), // Use the correct payload
                signal: controller.signal
            });
            // --- END OF REPLACED BLOCK ---


            clearTimeout(timeout);

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(errorData.error?.message || `HTTP ${response.status}: Failed to generate recipe`);
            }

            const result = await response.json();
            
            if (!result.choices || !result.choices[0] || !result.choices[0].message) {
                throw new Error('Invalid response from API');
            }
            
            const recipeText = result.choices[0].message.content;
            const formattedRecipe = formatRecipe(recipeText);
            
            // Analyze recipe metadata
            const difficulty = analyzeDifficulty(formattedRecipe);
            const times = extractTimes(formattedRecipe);
            const servings = extractServings(formattedRecipe);
            
            currentRecipe = {
                dishName: sanitized,
                recipeText: formattedRecipe,
                difficulty: difficulty,
                prepTime: times.prepTime,
                cookTime: times.cookTime,
                servings: servings
            };
            
            document.getElementById('recipeDishName').textContent = sanitized;
            document.getElementById('recipeText').innerHTML = formattedRecipe;
            
            // Update metadata display
            updateRecipeMetadata(difficulty, times.prepTime, times.cookTime, servings);
            
            updateSaveButton();
            addTimerButtons();
            displayNutritionInfo(sanitized, formattedRecipe);
            showVariations(sanitized, formattedRecipe);


            
            document.getElementById('loadingContainer').classList.add('hidden');
            document.getElementById('recipeContainer').classList.remove('hidden');

        } catch (err) {
            document.getElementById('loadingContainer').classList.add('hidden');
            document.getElementById('errorContainer').classList.remove('hidden');
            
            let errorMessage = '❌ Failed to generate recipe. ';
            
            if (err.name === 'AbortError') {
                errorMessage += 'Request timed out. Please try again.';
            } else if (err.message.includes('401') || err.message.includes('403')) {
                errorMessage += 'API authentication failed. Please check your API key.';
            } else if (err.message.includes('429')) {
                errorMessage += 'Too many requests. Please wait a moment and try again.';
            } else if (!navigator.onLine) {
                errorMessage += 'No internet connection. Please check your network.';
            } else {
                errorMessage += err.message || 'Unknown error occurred.';
            }
            
            document.getElementById('errorMessage').textContent = errorMessage;
            console.error('Recipe generation error:', err);
        }
    }
    function populateDishes(cuisine, filter) {
        const dishesContainer = document.getElementById('popularDishes');
        dishesContainer.innerHTML = '';
        
        const dishes = dishDatabase[cuisine]?.[filter] || [];
        
        if (dishes.length === 0) {
            dishesContainer.innerHTML = '<p class="text-gray-500">No dishes found for this filter</p>';
            return;
        }
        
        dishes.forEach(dish => {
            const dishCard = document.createElement('div');
dishCard.className = 'dish-card min-w-[200px] bg-gradient-to-br from-orange-50 to-red-50 rounded-2xl p-4 shadow-lg cursor-pointer hover:shadow-xl transition-all hover:scale-105';            dishCard.innerHTML = `
                <div class="text-4xl mb-2 text-center">🍽️</div>
                <h5 class="font-semibold text-gray-800 text-center">${dish}</h5>
            `;
            dishCard.addEventListener('click', () => {
                generateRecipe(dish, document.getElementById('hinglish').checked);
            });
            dishesContainer.appendChild(dishCard);
        });
    }

    // ============================================
    // EVENT LISTENERS
    // ============================================
    
    document.querySelectorAll('.cuisine-card').forEach(card => {
        card.addEventListener('click', () => {
            currentCuisine = card.dataset.cuisine;
            document.getElementById('selectedCuisineTitle').textContent = currentCuisine;
            document.getElementById('heroSection').classList.add('hidden');
            document.getElementById('filterSection').classList.remove('hidden');
            document.getElementById('backToHome').classList.remove('hidden');
            populateDishes(currentCuisine, currentFilter);
        });
    });

    document.querySelectorAll('.filter-chip').forEach(chip => {
        chip.addEventListener('click', () => {
            document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            chip.classList.add('active');
            currentFilter = chip.dataset.filter;
            populateDishes(currentCuisine, currentFilter);
        });
    });

    // Quick search with validation
    document.getElementById('quickSearchBtn').addEventListener('click', () => {
        const dish = document.getElementById('quickSearch').value.trim();
        if (dish) {
            const sanitized = sanitizeInput(dish);
            if (validateDishName(sanitized)) {
                generateRecipe(sanitized, false);
            }
        }
    });

    document.getElementById('quickSearch').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            const dish = e.target.value.trim();
            if (dish) {
                const sanitized = sanitizeInput(dish);
                if (validateDishName(sanitized)) {
                    generateRecipe(sanitized, false);
                }
            }
        }
    });

    // Custom dish generation
    document.getElementById('generateCustomBtn').addEventListener('click', () => {
        const dish = document.getElementById('customDish').value.trim();
        if (dish) {
            const sanitized = sanitizeInput(dish);
            if (validateDishName(sanitized)) {
                generateRecipe(sanitized, document.getElementById('hinglish').checked);
            }
        }
    });

    document.getElementById('customDish').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            const dish = e.target.value.trim();
            if (dish) {
                const sanitized = sanitizeInput(dish);
                if (validateDishName(sanitized)) {
                    generateRecipe(sanitized, document.getElementById('hinglish').checked);
                }
            }
        }
    });

    // Navigation
    document.getElementById('backToHome').addEventListener('click', () => {
        document.getElementById('heroSection').classList.remove('hidden');
        document.getElementById('filterSection').classList.add('hidden');
        document.getElementById('recipeContainer').classList.add('hidden');
        document.getElementById('backToHome').classList.add('hidden');
        document.getElementById('errorContainer').classList.add('hidden');
        document.getElementById('quickSearch').value = '';
        document.getElementById('customDish').value = '';
    });

    document.getElementById('newRecipeBtn').addEventListener('click', () => {
        if (currentCuisine) {
            document.getElementById('filterSection').classList.remove('hidden');
            document.getElementById('recipeContainer').classList.add('hidden');
        } else {
            document.getElementById('heroSection').classList.remove('hidden');
            document.getElementById('recipeContainer').classList.add('hidden');
            document.getElementById('backToHome').classList.add('hidden');
        }
        document.getElementById('errorContainer').classList.add('hidden');
    });

    // Print recipe
    document.getElementById('printRecipeBtn').addEventListener('click', () => {
        window.print();
    });

    // ============================================
    // INITIALIZATION
    // ============================================
    
    console.log('Namak Shamak initialized successfully! 🍽️');
// ============================================
// COOKING MODE - FULL-SCREEN STEP VIEW
// ============================================

let cookingModeActive = false;
let cookingModeSteps = [];
let currentCookingStep = 0;
let wakeLock = null;

function extractSteps() {
    const stepElements = document.querySelectorAll('.step-item');
    const steps = [];
    
    stepElements.forEach((el, index) => {
        const stepText = el.textContent.replace(/^\d+/, '').trim();
        const timeMatch = stepText.match(/(\d+)\s*(?:min|minute|minutes)/i);
        
        steps.push({
            number: index + 1,
            text: stepText,
            hasTimer: !!timeMatch,
            timerMinutes: timeMatch ? parseInt(timeMatch[1]) : null
        });
    });
    
    return steps;
}

function startCookingMode() {
    cookingModeSteps = extractSteps();
    
    if (cookingModeSteps.length === 0) {
        showNotification('No cooking steps found', 'warning');
        return;
    }
    
    currentCookingStep = 0;
    cookingModeActive = true;
    
    document.getElementById('cookingModeOverlay').classList.add('active');
    document.getElementById('cookingModeTotalSteps').textContent = cookingModeSteps.length;
    
    updateCookingModeStep();
    requestWakeLock();
}

function exitCookingMode() {
    cookingModeActive = false;
    document.getElementById('cookingModeOverlay').classList.remove('active');
    releaseWakeLock();
}

function updateCookingModeStep() {
    if (currentCookingStep < 0 || currentCookingStep >= cookingModeSteps.length) return;
    
    const step = cookingModeSteps[currentCookingStep];
    
    document.getElementById('cookingModeCurrentStep').textContent = currentCookingStep + 1;
    document.getElementById('cookingModeStepNum').textContent = step.number;
    document.getElementById('cookingModeStepText').textContent = step.text;
    
    // Update progress bar
    const progress = ((currentCookingStep + 1) / cookingModeSteps.length) * 100;
    document.getElementById('cookingModeProgressFill').style.width = `${progress}%`;
    
    // Show/hide timer button
    const timerBtn = document.getElementById('cookingModeTimerBtn');
    if (step.hasTimer) {
        timerBtn.classList.remove('hidden');
        timerBtn.textContent = `Start ${step.timerMinutes}-min Timer`;
    } else {
        timerBtn.classList.add('hidden');
    }
    
    // Update navigation buttons
    document.getElementById('cookingModePrevBtn').disabled = currentCookingStep === 0;
    document.getElementById('cookingModeNextBtn').disabled = currentCookingStep === cookingModeSteps.length - 1;
    
    if (currentCookingStep === cookingModeSteps.length - 1) {
        document.getElementById('cookingModeNextBtn').innerHTML = `
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
            Complete
        `;
    } else {
        document.getElementById('cookingModeNextBtn').innerHTML = `
            Next
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
        `;
    }
}

function nextCookingStep() {
    if (currentCookingStep < cookingModeSteps.length - 1) {
        currentCookingStep++;
        updateCookingModeStep();
    } else {
        showNotification('🎉 Recipe completed!', 'success');
        exitCookingMode();
    }
}

function prevCookingStep() {
    if (currentCookingStep > 0) {
        currentCookingStep--;
        updateCookingModeStep();
    }
}

function showIngredientsPopup() {
    const popup = document.getElementById('cookingModeIngredientsPopup');
    const list = document.getElementById('cookingModeIngredientsList');
    
    const ingredients = Array.from(document.querySelectorAll('.ingredient-item'))
        .map(el => el.textContent.trim())
        .filter(text => text);
    
    list.innerHTML = ingredients.map(ing => 
        `<div class="ingredient-item mb-2">${ing}</div>`
    ).join('');
    
    popup.classList.add('show');
}

function closeIngredientsPopup() {
    document.getElementById('cookingModeIngredientsPopup').classList.remove('show');
}

// Wake Lock API to keep screen awake
async function requestWakeLock() {
    try {
        if ('wakeLock' in navigator) {
            wakeLock = await navigator.wakeLock.request('screen');
            console.log('Screen wake lock activated');
        }
    } catch (err) {
        console.log('Wake lock not supported:', err);
    }
}

function releaseWakeLock() {
    if (wakeLock) {
        wakeLock.release();
        wakeLock = null;
        console.log('Screen wake lock released');
    }
}

// Event Listeners
document.getElementById('startCookingModeBtn').addEventListener('click', startCookingMode);
document.getElementById('cookingModeExit').addEventListener('click', exitCookingMode);
document.getElementById('cookingModeNextBtn').addEventListener('click', nextCookingStep);
document.getElementById('cookingModePrevBtn').addEventListener('click', prevCookingStep);
document.getElementById('cookingModeSkip').addEventListener('click', exitCookingMode);
document.getElementById('cookingModeIngredientsBtn').addEventListener('click', showIngredientsPopup);
document.getElementById('closeIngredientsPopup').addEventListener('click', closeIngredientsPopup);

// Timer button in cooking mode
document.getElementById('cookingModeTimerBtn').addEventListener('click', () => {
    const step = cookingModeSteps[currentCookingStep];
    if (step.hasTimer) {
        startTimer(step.timerMinutes * 60, `Step ${step.number}`, `${step.timerMinutes} minutes`);
        showNotification(`⏱ ${step.timerMinutes}-minute timer started!`, 'success');
    }
});

// Keyboard navigation
document.addEventListener('keydown', (e) => {
    if (!cookingModeActive) return;
    
    if (e.key === 'ArrowRight' || e.key === 'Enter') {
        nextCookingStep();
    } else if (e.key === 'ArrowLeft') {
        prevCookingStep();
    } else if (e.key === 'Escape') {
        exitCookingMode();
    }
});

// Swipe gestures for mobile
let touchStartX = 0;
let touchEndX = 0;

document.getElementById('cookingModeOverlay').addEventListener('touchstart', (e) => {
    touchStartX = e.changedTouches[0].screenX;
});

document.getElementById('cookingModeOverlay').addEventListener('touchend', (e) => {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
});

function handleSwipe() {
    const swipeThreshold = 50;
    
    if (touchEndX < touchStartX - swipeThreshold) {
        nextCookingStep();
    }
    
    if (touchEndX > touchStartX + swipeThreshold) {
        prevCookingStep();
    }
}

console.log('🍳 Cooking Mode initialized!');
// ============================================
// SEARCH HISTORY SYSTEM
// ============================================

function getSearchHistory() {
    try {
        const history = localStorage.getItem('searchHistory');
        if (!history) return [];
        
        const parsed = JSON.parse(history);
        return Array.isArray(parsed) ? parsed : [];
    } catch (error) {
        console.error('Failed to load search history:', error);
        localStorage.removeItem('searchHistory');
        return [];
    }
}

function saveToSearchHistory(dishName) {
    try {
        let history = getSearchHistory();
        
        // Remove if already exists (to move to top)
        history = history.filter(item => item.dish.toLowerCase() !== dishName.toLowerCase());
        
        // Add to beginning
        history.unshift({
            dish: dishName,
            timestamp: new Date().toISOString(),
            emoji: getRandomFoodEmoji()
        });
        
        // Keep only last 20 searches
        history = history.slice(0, 20);
        
        localStorage.setItem('searchHistory', JSON.stringify(history));
        updateSearchHistoryUI();
    } catch (error) {
        console.error('Failed to save search history:', error);
    }
}

function deleteFromSearchHistory(timestamp) {
    try {
        let history = getSearchHistory();
        history = history.filter(item => item.timestamp !== timestamp);
        localStorage.setItem('searchHistory', JSON.stringify(history));
        updateSearchHistoryUI();
    } catch (error) {
        console.error('Failed to delete from history:', error);
    }
}

function clearSearchHistory() {
    if (confirm('Clear all search history?')) {
        localStorage.removeItem('searchHistory');
        updateSearchHistoryUI();
        showNotification('✓ Search history cleared', 'success');
    }
}

function getRandomFoodEmoji() {
    const emojis = ['🍛', '🍕', '🍝', '🥘', '🍜', '🥗', '🍲', '🥙', '🌮', '🍔', '🍱', '🍳', '🥞', '🧆', '🍤', '🍢'];
    return emojis[Math.floor(Math.random() * emojis.length)];
}

function formatTimeAgo(timestamp) {
    const now = new Date();
    const past = new Date(timestamp);
    const diffMs = now - past;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);
    
    if (diffMins < 1) return 'Just now';
    if (diffMins < 60) return `${diffMins} min ago`;
    if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
    if (diffDays < 7) return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
    
    return past.toLocaleDateString();
}

function groupHistoryByDate(history) {
    const now = new Date();
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    const yesterday = new Date(today);
    yesterday.setDate(yesterday.getDate() - 1);
    const weekAgo = new Date(today);
    weekAgo.setDate(weekAgo.getDate() - 7);
    
    const groups = {
        today: [],
        yesterday: [],
        thisWeek: [],
        older: []
    };
    
    history.forEach(item => {
        const itemDate = new Date(item.timestamp);
        const itemDay = new Date(itemDate.getFullYear(), itemDate.getMonth(), itemDate.getDate());
        
        if (itemDay.getTime() === today.getTime()) {
            groups.today.push(item);
        } else if (itemDay.getTime() === yesterday.getTime()) {
            groups.yesterday.push(item);
        } else if (itemDate >= weekAgo) {
            groups.thisWeek.push(item);
        } else {
            groups.older.push(item);
        }
    });
    
    return groups;
}

function updateSearchHistoryUI() {
    const history = getSearchHistory();
    const historyCount = document.getElementById('historyCount');
    const historyList = document.getElementById('searchHistoryList');
    
    // Update count badge
    if (history.length > 0) {
        historyCount.textContent = history.length;
        historyCount.classList.remove('hidden');
    } else {
        historyCount.classList.add('hidden');
    }
    
    // Display history
    if (history.length === 0) {
        historyList.innerHTML = `
            <div class="history-empty">
                <div class="history-empty-icon">🔍</div>
                <p>No search history yet</p>
                <p style="font-size: 0.875rem; margin-top: 0.5rem;">Your recipe searches will appear here</p>
            </div>
        `;
        return;
    }
    
    const groups = groupHistoryByDate(history);
    let html = '';
    
    // Today
    if (groups.today.length > 0) {
        html += `
            <div class="history-group">
                <div class="history-group-title">Today</div>
                ${groups.today.map(item => createHistoryItemHTML(item)).join('')}
            </div>
        `;
    }
    
    // Yesterday
    if (groups.yesterday.length > 0) {
        html += `
            <div class="history-group">
                <div class="history-group-title">Yesterday</div>
                ${groups.yesterday.map(item => createHistoryItemHTML(item)).join('')}
            </div>
        `;
    }
    
    // This Week
    if (groups.thisWeek.length > 0) {
        html += `
            <div class="history-group">
                <div class="history-group-title">This Week</div>
                ${groups.thisWeek.map(item => createHistoryItemHTML(item)).join('')}
            </div>
        `;
    }
    
    // Older
    if (groups.older.length > 0) {
        html += `
            <div class="history-group">
                <div class="history-group-title">Older</div>
                ${groups.older.map(item => createHistoryItemHTML(item)).join('')}
            </div>
        `;
    }
    
    historyList.innerHTML = html;
    
    // Add click handlers
    document.querySelectorAll('.history-item').forEach(item => {
        item.addEventListener('click', (e) => {
            if (!e.target.closest('.history-delete-btn')) {
                const dishName = item.dataset.dish;
                generateRecipe(dishName, false);
                document.getElementById('searchHistoryDropdown').classList.remove('show');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });
    });
    
    document.querySelectorAll('.history-delete-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const timestamp = btn.dataset.timestamp;
            deleteFromSearchHistory(timestamp);
        });
    });
}

function createHistoryItemHTML(item) {
    return `
        <div class="history-item" data-dish="${item.dish}">
            <div class="history-emoji">${item.emoji}</div>
            <div class="history-content">
                <div class="history-dish-name">${item.dish}</div>
                <div class="history-time">${formatTimeAgo(item.timestamp)}</div>
            </div>
            <button class="history-delete-btn" data-timestamp="${item.timestamp}" aria-label="Delete from history">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
            </button>
        </div>
    `;
}

// Event listeners
document.getElementById('searchHistoryBtn').addEventListener('click', (e) => {
    e.stopPropagation();
    document.getElementById('searchHistoryDropdown').classList.toggle('show');
});

document.getElementById('clearHistoryBtn').addEventListener('click', clearSearchHistory);

document.addEventListener('click', (e) => {
    const dropdown = document.getElementById('searchHistoryDropdown');
    const btn = document.getElementById('searchHistoryBtn');
    if (!dropdown.contains(e.target) && !btn.contains(e.target)) {
        dropdown.classList.remove('show');
    }
});

// Initialize
updateSearchHistoryUI();

console.log('📜 Search History feature loaded!');
// ============================================
// PROGRESSIVE WEB APP (PWA)
// ============================================

let deferredPrompt;
const installBtn = document.getElementById('installBtn');

// Detect if app can be installed
window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installBtn.classList.remove('hidden');
    console.log('PWA install prompt available');
});

// Install button click
installBtn.addEventListener('click', async () => {
    if (!deferredPrompt) return;
    
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    
    if (outcome === 'accepted') {
        showNotification('✓ App installed successfully!', 'success');
        console.log('PWA installed');
    }
    
    deferredPrompt = null;
    installBtn.classList.add('hidden');
});

// Detect if already installed
window.addEventListener('appinstalled', () => {
    showNotification('✓ Namak Shamak installed!', 'success');
    deferredPrompt = null;
});

// Service Worker for offline support
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
            .then(registration => console.log('SW registered:', registration))
            .catch(err => console.log('SW registration failed:', err));
    });
}

console.log('📱 PWA features loaded!');
// ============================================
// VOICE ASSISTANT (DUNA)
// ============================================

let recognition = null;
let synthesis = window.speechSynthesis;
let isListening = false;

// Initialize Speech Recognition
if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    
    recognition.continuous = false;
    recognition.interimResults = true;
    recognition.lang = 'en-US';
    
    console.log('🎤 Voice Assistant ready!');
} else {
    console.warn('Speech Recognition not supported');
}

// Voice button click
document.getElementById('voiceBtn').addEventListener('click', startListening);

function startListening() {
    if (!recognition) {
        showNotification('Voice recognition not supported in this browser', 'error');
        return;
    }
    
    isListening = true;
    document.getElementById('voiceOverlay').classList.add('active');
    document.getElementById('voiceBtn').classList.add('listening');
    document.getElementById('voiceStatus').textContent = '🎤 Listening...';
    document.getElementById('voiceTranscript').textContent = 'Say something...';
    
    try {
        recognition.start();
    } catch (error) {
        console.error('Recognition start error:', error);
    }
}

function stopListening() {
    if (recognition && isListening) {
        recognition.stop();
        isListening = false;
        document.getElementById('voiceOverlay').classList.remove('active');
        document.getElementById('voiceBtn').classList.remove('listening');
    }
}

// Handle speech recognition results
if (recognition) {
    recognition.onresult = (event) => {
        const transcript = event.results[event.results.length - 1][0].transcript.toLowerCase();
        document.getElementById('voiceTranscript').textContent = transcript;
        
        // Final result - process command
        if (event.results[event.results.length - 1].isFinal) {
            processVoiceCommand(transcript);
        }
    };
    
   recognition.onerror = (event) => {
    console.error('Speech recognition error:', event.error);
    
    let errorMessage = '';
    switch(event.error) {
        case 'network':
            errorMessage = '❌ Network Error\nCheck your internet connection';
            showNotification('No internet connection. Check and try again.', 'error');
            break;
        case 'audio-capture':
            errorMessage = '❌ Microphone Error\nGrant microphone permission';
            showNotification('Allow microphone access in browser settings', 'error');
            break;
        case 'not-allowed':
            errorMessage = '❌ Permission Denied\nEnable microphone in settings';
            showNotification('Microphone permission denied', 'error');
            break;
        case 'no-speech':
            errorMessage = '🤷 No Speech Detected\nPlease speak clearly';
            showNotification('No speech detected. Try again.', 'warning');
            break;
        default:
            errorMessage = '❌ Error: ' + event.error;
            showNotification('Voice recognition error. Try again.', 'error');
    }
    
    document.getElementById('voiceStatus').textContent = errorMessage;
    setTimeout(stopListening, 3000);
};

    recognition.onend = () => {
        if (isListening) {
            setTimeout(stopListening, 1000);
        }
    };
}

// Process voice commands
function processVoiceCommand(command) {
    document.getElementById('voiceStatus').textContent = '⚡ Processing...';
    
    // Search commands
    if (command.includes('search') || command.includes('show me') || command.includes('find')) {
        const dishMatch = command.replace(/search for|show me|find|recipe/gi, '').trim();
        if (dishMatch) {
            speak(`Searching for ${dishMatch}`);
            setTimeout(() => {
                generateRecipe(dishMatch, false);
                stopListening();
            }, 1000);
            return;
        }
    }
    
    // Cuisine commands
    if (command.includes('indian')) selectCuisine('Indian');
    else if (command.includes('italian')) selectCuisine('Italian');
    else if (command.includes('chinese')) selectCuisine('Chinese');
    else if (command.includes('mexican')) selectCuisine('Mexican');
    else if (command.includes('japanese')) selectCuisine('Japanese');
    else if (command.includes('thai')) selectCuisine('Thai');
    
    // Navigation commands
    if (command.includes('next step') || command.includes('next')) {
        if (cookingModeActive) {
            nextCookingStep();
            speak('Moving to next step');
        }
        stopListening();
        return;
    }
    
    if (command.includes('previous step') || command.includes('back')) {
        if (cookingModeActive) {
            prevCookingStep();
            speak('Going back');
        }
        stopListening();
        return;
    }
    
    if (command.includes('repeat') || command.includes('read again')) {
        if (currentRecipe) {
            readCurrentStep();
        }
        stopListening();
        return;
    }
    
    // Read recipe
    if (command.includes('read') && command.includes('recipe')) {
        if (currentRecipe) {
            readRecipe();
            stopListening();
        }
        return;
    }
    
    // Start cooking mode
    if (command.includes('start cooking') || command.includes('cooking mode')) {
        if (currentRecipe) {
            startCookingMode();
            speak('Starting cooking mode');
        }
        stopListening();
        return;
    }
    
    // Default response
    speak("I didn't understand that. Try saying search for butter chicken");
    setTimeout(stopListening, 2000);
}

function selectCuisine(cuisine) {
    speak(`Showing ${cuisine} recipes`);
    setTimeout(() => {
        currentCuisine = cuisine;
        document.getElementById('selectedCuisineTitle').textContent = cuisine;
        document.getElementById('heroSection').classList.add('hidden');
        document.getElementById('filterSection').classList.remove('hidden');
        document.getElementById('backToHome').classList.remove('hidden');
        populateDishes(cuisine, currentFilter);
        stopListening();
    }, 1000);
}

// Text-to-Speech
function speak(text) {
    if (!synthesis) return;
    
    synthesis.cancel(); // Stop any ongoing speech
    
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.rate = 1.0;
    utterance.pitch = 1.0;
    utterance.volume = 1.0;
    utterance.lang = 'en-US';
    
    synthesis.speak(utterance);
}

function readRecipe() {
    if (!currentRecipe) return;
    
    const ingredients = Array.from(document.querySelectorAll('.ingredient-item'))
        .map(el => el.textContent.trim())
        .join('. ');
    
    const steps = Array.from(document.querySelectorAll('.step-item'))
        .map((el, index) => `Step ${index + 1}. ${el.textContent.trim()}`)
        .join('. ');
    
    speak(`Recipe for ${currentRecipe.dishName}. Ingredients: ${ingredients}. Instructions: ${steps}`);
}

function readCurrentStep() {
    if (cookingModeActive && cookingModeSteps[currentCookingStep]) {
        const step = cookingModeSteps[currentCookingStep];
        speak(`Step ${step.number}. ${step.text}`);
    }
}

// Close voice overlay
document.getElementById('closeVoice').addEventListener('click', stopListening);

// Close on escape
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && isListening) {
        stopListening();
    }
});

console.log('🎤 Voice Assistant (Duna) loaded!');
// ============================================
// AI RECIPE FROM INGREDIENTS
// ============================================

let selectedIngredients = [];

const ingredientsInput = document.getElementById('ingredientsInput');
const ingredientTags = document.getElementById('ingredientTags');
const generateBtn = document.getElementById('generateFromIngredientsBtn');

// Add ingredient on Enter key
ingredientsInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        const ingredient = ingredientsInput.value.trim().toLowerCase();
        if (ingredient && !selectedIngredients.includes(ingredient)) {
            addIngredient(ingredient);
            ingredientsInput.value = '';
        }
    }
});

// Quick add chips
document.querySelectorAll('.quick-ingredient-chip').forEach(chip => {
    chip.addEventListener('click', () => {
        const ingredient = chip.dataset.ingredient;
        if (!selectedIngredients.includes(ingredient)) {
            addIngredient(ingredient);
        }
    });
});

function addIngredient(ingredient) {
    selectedIngredients.push(ingredient);
    updateIngredientTags();
    updateGenerateButton();
}

function removeIngredient(ingredient) {
    selectedIngredients = selectedIngredients.filter(i => i !== ingredient);
    updateIngredientTags();
    updateGenerateButton();
}

function updateIngredientTags() {
    if (selectedIngredients.length === 0) {
        ingredientTags.innerHTML = '<p style="color: #9ca3af; font-size: 0.875rem;">No ingredients added yet. Add some above!</p>';
        return;
    }
    
    ingredientTags.innerHTML = selectedIngredients.map(ingredient => `
        <div class="ingredient-tag">
            ${ingredient}
            <span class="ingredient-tag-remove" data-ingredient="${ingredient}">✕</span>
        </div>
    `).join('');
    
    // Add remove listeners
    document.querySelectorAll('.ingredient-tag-remove').forEach(btn => {
        btn.addEventListener('click', () => {
            removeIngredient(btn.dataset.ingredient);
        });
    });
}

function updateGenerateButton() {
    if (selectedIngredients.length >= 2) {
        generateBtn.disabled = false;
    } else {
        generateBtn.disabled = true;
    }
}

// Generate recipe from ingredients
generateBtn.addEventListener('click', () => {
    if (selectedIngredients.length < 2) {
        showNotification('Add at least 2 ingredients', 'warning');
        return;
    }
    
    const ingredientsList = selectedIngredients.join(', ');
    showNotification('🧠 AI is creating a custom recipe...', 'info');
    
    // Use existing generateRecipe function (which already works)
    const recipeName = `Recipe with ${ingredientsList}`;
    generateRecipe(recipeName, false);
    
    // Clear ingredients for next use
    selectedIngredients = [];
    updateIngredientTags();
    updateGenerateButton();
});
// Initialize
updateIngredientTags();

console.log('🧠 AI Recipe Generator loaded!');
// ============================================
// SOCIAL SHARING
// ============================================
const shareModal = document.getElementById('shareModal');
const shareBtn = document.getElementById('shareBtn');
const closeShareModal = document.getElementById('closeShareModal');
// Show modal
shareBtn.addEventListener('click', () => {
    shareModal.style.display = 'flex';
});
// Close modal
closeShareModal.addEventListener('click', () => {
    shareModal.style.display = 'none';
});

// Close on background click
shareModal.addEventListener('click', (e) => {
    if (e.target === shareModal) {
        shareModal.style.display = 'none';
    }
});

function shareRecipe(platform) {
    if (!currentRecipe) {
        showNotification('Generate a recipe first!', 'warning');
        return;
    }
    
    const recipeName = currentRecipe.dishName;
    const text = `Check out this ${recipeName} recipe from Namak Shamak! 🍽️`;
    const url = window.location.href;
    
    let shareUrl = '';
    
    switch(platform) {
        case 'whatsapp':
            shareUrl = `https://wa.me/?text=${encodeURIComponent(text + ' ' + url)}`;
            break;
        case 'twitter':
            shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
            break;
        case 'facebook':
            shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
            break;
        case 'copy':
            navigator.clipboard.writeText(url).then(() => {
                showNotification('✓ Link copied to clipboard!', 'success');
            });
            shareModal.style.display = 'none';
            return;
    }
    
    if (shareUrl) {
        window.open(shareUrl, '_blank');
        shareModal.style.display = 'none';
    }
}

document.getElementById('shareWhatsApp').addEventListener('click', () => shareRecipe('whatsapp'));
document.getElementById('shareTwitter').addEventListener('click', () => shareRecipe('twitter'));
document.getElementById('shareFacebook').addEventListener('click', () => shareRecipe('facebook'));
document.getElementById('shareCopy').addEventListener('click', () => shareRecipe('copy'));

console.log('🔔 Social sharing fixed!');

// ============================================
// SMART RECIPE RECOMMENDATIONS
// ============================================

function getRecommendations() {
    const history = getSearchHistory();
    if (history.length === 0) return [];
    
    // Analyze user preferences
    const cuisineCount = {};
    const recentSearches = history.slice(0, 10);
    
    recentSearches.forEach(item => {
        const dish = item.dish.toLowerCase();
        
        // Detect cuisine patterns
        if (dish.includes('chicken') || dish.includes('butter') || dish.includes('curry') || dish.includes('biryani')) {
            cuisineCount['Indian'] = (cuisineCount['Indian'] || 0) + 1;
        }
        if (dish.includes('pizza') || dish.includes('pasta') || dish.includes('italian')) {
            cuisineCount['Italian'] = (cuisineCount['Italian'] || 0) + 1;
        }
        if (dish.includes('taco') || dish.includes('burrito') || dish.includes('mexican')) {
            cuisineCount['Mexican'] = (cuisineCount['Mexican'] || 0) + 1;
        }
        if (dish.includes('sushi') || dish.includes('ramen') || dish.includes('japanese')) {
            cuisineCount['Japanese'] = (cuisineCount['Japanese'] || 0) + 1;
        }
    });
    
    // Get top cuisine
    const topCuisine = Object.keys(cuisineCount).sort((a, b) => cuisineCount[b] - cuisineCount[a])[0];
    
    // Recommendation database
    const recommendations = {
        'Indian': [
            { name: 'Paneer Tikka Masala', icon: '🧆', reason: 'You love Indian flavors!' },
            { name: 'Dal Makhani', icon: '🍛', reason: 'Perfect with naan' },
            { name: 'Chicken Korma', icon: '🍗', reason: 'Mild and creamy' }
        ],
        'Italian': [
            { name: 'Carbonara', icon: '🍝', reason: 'Classic Italian pasta!' },
            { name: 'Margherita Pizza', icon: '🍕', reason: 'Simple perfection' },
            { name: 'Tiramisu', icon: '🍰', reason: 'Sweet ending' }
        ],
        'Mexican': [
            { name: 'Chicken Enchiladas', icon: '🌮', reason: 'Loaded with flavor!' },
            { name: 'Guacamole', icon: '🥑', reason: 'Perfect appetizer' },
            { name: 'Churros', icon: '🍩', reason: 'Sweet treat' }
        ],
        'Japanese': [
            { name: 'Chicken Teriyaki', icon: '🍱', reason: 'Sweet and savory!' },
            { name: 'Miso Soup', icon: '🍜', reason: 'Warm comfort' },
            { name: 'Tempura', icon: '🍤', reason: 'Crispy delight' }
        ]
    };
    
    // Fallback popular recommendations
    const fallback = [
        { name: 'Butter Chicken', icon: '🍛', reason: 'Most popular recipe!' },
        { name: 'Margherita Pizza', icon: '🍕', reason: 'Classic favorite' },
        { name: 'Pad Thai', icon: '🍜', reason: 'Thai street food' }
    ];
    
    return recommendations[topCuisine] || fallback;
}

function displayRecommendations() {
    const recommendations = getRecommendations();
    const section = document.getElementById('recommendationsSection');
    const container = document.getElementById('recommendationCards');
    
    if (recommendations.length === 0) {
        section.classList.add('hidden');
        return;
    }
    
    container.innerHTML = recommendations.map(rec => `
        <div class="recommendation-card" data-recipe="${rec.name}">
            <div class="recommendation-icon">${rec.icon}</div>
            <div class="recommendation-name">${rec.name}</div>
            <div class="recommendation-reason">${rec.reason}</div>
        </div>
    `).join('');
    
    section.classList.remove('hidden');
    
    // Add click handlers
    document.querySelectorAll('.recommendation-card').forEach(card => {
        card.addEventListener('click', () => {
            const recipe = card.dataset.recipe;
            generateRecipe(recipe, false);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    });
}

// Update recommendations when page loads and after searches
displayRecommendations();

// Hook into existing search to update recommendations
const originalGenerateRecipe = generateRecipe;
generateRecipe = function(...args) {
    originalGenerateRecipe.apply(this, args);
    setTimeout(displayRecommendations, 500);
};

console.log('🌟 Smart recommendations loaded!');
// ============================================
// FUN EASTER EGGS 🎪
// ============================================

// 1. Confetti on successful recipe generation
function throwConfetti() {
    const colors = ['#f97316', '#ea580c', '#fbbf24', '#34d399', '#60a5fa', '#a78bfa'];
    
    for (let i = 0; i < 50; i++) {
        setTimeout(() => {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + '%';
            confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDelay = Math.random() * 0.5 + 's';
            document.body.appendChild(confetti);
            
            setTimeout(() => confetti.remove(), 3000);
        }, i * 30);
    }
}

// 2. Konami Code easter egg (↑↑↓↓←→←→BA)
let konamiCode = [];
const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];

document.addEventListener('keydown', (e) => {
    konamiCode.push(e.key);
    if (konamiCode.length > 10) konamiCode.shift();
    
    if (konamiCode.join(',') === konamiSequence.join(',')) {
        document.querySelector('h1').classList.add('rainbow-text');
        throwConfetti();
        showNotification('🎉 Konami Code Activated! You found the secret!', 'success');
        konamiCode = [];
    }
});

// 3. Click logo 10 times for surprise
let logoClicks = 0;
document.querySelector('h1').addEventListener('click', () => {
    logoClicks++;
    if (logoClicks === 10) {
        throwConfetti();
        floatingEmojis(['🎉', '🍕', '🍔', '🌮', '🍜', '🍱', '🍰', '🍦']);
        showNotification('🎊 You found the secret party!', 'success');
        logoClicks = 0;
    }
});

// 4. Floating emojis
function floatingEmojis(emojis) {
    emojis.forEach((emoji, i) => {
        setTimeout(() => {
            const floater = document.createElement('div');
            floater.className = 'floating-emoji';
            floater.textContent = emoji;
            floater.style.left = Math.random() * 80 + 10 + '%';
            floater.style.bottom = '0';
            document.body.appendChild(floater);
            
            setTimeout(() => floater.remove(), 4000);
        }, i * 200);
    });
}

// 5. Shake on error
const originalShowNotification = showNotification;
showNotification = function(message, type) {
    originalShowNotification(message, type);
    if (type === 'error') {
        document.body.classList.add('shake');
        setTimeout(() => document.body.classList.remove('shake'), 500);
    }
    if (type === 'success' && message.includes('recipe') && message.includes('generated')) {
        throwConfetti();
    }
};

// 6. Double-click cuisine cards for random recipe
document.querySelectorAll('.cuisine-card').forEach(card => {
    card.addEventListener('dblclick', () => {
        const cuisine = card.dataset.cuisine;
        const randomDishes = [
            'Surprise Recipe', 'Mystery Dish', 'Chef\'s Special', 
            'Random Creation', 'Lucky Recipe'
        ];
        const random = randomDishes[Math.floor(Math.random() * randomDishes.length)];
        showNotification(`🎲 Getting random ${cuisine} recipe!`, 'info');
        generateRecipe(`${cuisine} ${random}`, false);
    });
});

// 7. Typing "chef" reveals secret
let typedText = '';
document.addEventListener('keypress', (e) => {
    typedText += e.key;
    if (typedText.length > 4) typedText = typedText.slice(-4);
    
    if (typedText === 'chef') {
        floatingEmojis(['👨‍🍳', '🔪', '🥘', '⭐']);
        showNotification('👨‍🍳 Master Chef Mode Unlocked!', 'success');
        typedText = '';
    }
});
console.log('🎪 Easter eggs loaded! Try:');
console.log('- Click logo 10 times');
console.log('- Type "chef"');
console.log('- Konami code: ↑↑↓↓←→←→BA');
console.log('- Double-click cuisine cards');
</script>
